"use strict";(self.webpackChunk_jupyterlab_scheduler=self.webpackChunk_jupyterlab_scheduler||[]).push([[627],{4627:(e,t,n)=>{n.r(t),n.d(t,{CommandIDs:()=>we,NotebookJobsPanelId:()=>Je,default:()=>Ie});var o=n(6271),a=n.n(o),l=n(6633),r=n(7854),i=n(9341),s=n(4944),c=n(348),u=n(4411),d=n(6625),m=n(822);const b=new m.LabIcon({name:"jupyterlab-scheduler:calendar-add-on",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" height="16px" width="16px">\n  <path fill="#0097A7" d="M10 15.833H4.25q-.729 0-1.24-.51-.51-.511-.51-1.24v-9q0-.729.51-1.239.511-.511 1.24-.511H5V1.667h1.75v1.666h4.833V1.667h1.75v1.666h.75q.729 0 1.24.511.51.51.51 1.239v4.959q-.229-.042-.437-.063-.208-.021-.438-.021-.229 0-.437.021-.209.021-.438.063V7.583H4.25v6.5H10q-.042.229-.062.438-.021.208-.021.437 0 .23.021.438.02.208.062.437Zm4.083 2.5v-2.5h-2.5v-1.75h2.5v-2.5h1.75v2.5h2.5v1.75h-2.5v2.5Z"/>\n</svg>\n'}),p=new m.LabIcon({name:"jupyterlab-scheduler:calendar-month",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" height="16px" width="16px">\n  <path fill="#0097A7" d="M10 12q-.312 0-.531-.219-.219-.219-.219-.531 0-.312.219-.531.219-.219.531-.219.312 0 .531.219.219.219.219.531 0 .312-.219.531Q10.312 12 10 12Zm-3.25 0q-.312 0-.531-.219Q6 11.562 6 11.25q0-.312.219-.531.219-.219.531-.219.312 0 .531.219.219.219.219.531 0 .312-.219.531Q7.062 12 6.75 12Zm6.5 0q-.312 0-.531-.219-.219-.219-.219-.531 0-.312.219-.531.219-.219.531-.219.312 0 .531.219.219.219.219.531 0 .312-.219.531-.219.219-.531.219ZM10 15q-.312 0-.531-.219-.219-.219-.219-.531 0-.312.219-.531.219-.219.531-.219.312 0 .531.219.219.219.219.531 0 .312-.219.531Q10.312 15 10 15Zm-3.25 0q-.312 0-.531-.219Q6 14.562 6 14.25q0-.312.219-.531.219-.219.531-.219.312 0 .531.219.219.219.219.531 0 .312-.219.531Q7.062 15 6.75 15Zm6.5 0q-.312 0-.531-.219-.219-.219-.219-.531 0-.312.219-.531.219-.219.531-.219.312 0 .531.219.219.219.219.531 0 .312-.219.531-.219.219-.531.219ZM4.5 18q-.625 0-1.062-.448Q3 17.104 3 16.5v-11q0-.604.438-1.052Q3.875 4 4.5 4H6V2h1.5v2h5V2H14v2h1.5q.625 0 1.062.448Q17 4.896 17 5.5v11q0 .604-.438 1.052Q16.125 18 15.5 18Zm0-1.5h11V9h-11v7.5Z"/>\n</svg>\n'}),h=new m.LabIcon({name:"jupyterlab-scheduler:event-note",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48">\n  <path fill="#0097A7" d="M14 27v-3h20v3Zm0 9v-3h13.95v3Zm-5 8q-1.2 0-2.1-.9Q6 42.2 6 41V10q0-1.2.9-2.1Q7.8 7 9 7h3.25V4h3.25v3h17V4h3.25v3H39q1.2 0 2.1.9.9.9.9 2.1v31q0 1.2-.9 2.1-.9.9-2.1.9Zm0-3h30V19.5H9V41Z"/>\n</svg>\n'}),v=new m.LabIcon({name:"jupyterlab-scheduler:replay",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" height="16px" width="16px">\n  <path class="jp-icon3" fill="#616161" d="M10 18.125q-1.458 0-2.729-.552-1.271-.552-2.219-1.5t-1.5-2.219Q3 12.583 3 11.125h1.5q0 2.271 1.615 3.885Q7.729 16.625 10 16.625t3.885-1.615q1.615-1.614 1.615-3.885T13.885 7.24Q12.271 5.625 10 5.625h-.125l1.063 1.063L9.875 7.75 7 4.875 9.875 2l1.063 1.062-1.084 1.063H10q1.458 0 2.729.552 1.271.552 2.219 1.5t1.5 2.219Q17 9.667 17 11.125q0 1.458-.552 2.729-.552 1.271-1.5 2.219t-2.219 1.5q-1.271.552-2.729.552Z"/>\n</svg>\n'}),g=a().createContext(u.nullTranslator);function _(e){return(0,o.useContext)(g).load(e)}function j(e){const t=e.runningJobs;if(!t)return null;const n=_("jupyterlab"),o=t>1?n.__("%1 jobs running",t):n.__("%1 job running",t);return a().createElement("div",{className:c.interactiveItem,style:{paddingLeft:"4px",paddingRight:"4px"}},a().createElement(c.GroupItem,{spacing:4,title:o,onClick:e.handleClick},a().createElement(c.TextItem,{source:`${t}`}),a().createElement(m.LabIcon.resolveReact,{icon:p,tag:"span"})))}function f(e){return a().createElement(r.UseSignal,{signal:e.model.inProgressJobCountChanged},((t,n)=>a().createElement(j,{handleClick:e.onClick,runningJobs:n})))}var E,C=n(4524),y=n(6608);class w{constructor(e){this.serverSettings=e.serverSettings||y.ServerConnection.makeSettings()}async getJobDefinitions(e){let t,n="";e&&(n=`/${e}`);try{t=await J(this.serverSettings,`job_definitions${n}`,{method:"GET"})}catch(e){console.error(e)}return t}async createJobDefinition(e){let t;try{t=await J(this.serverSettings,"job_definitions",{method:"POST",body:JSON.stringify(e)})}catch(e){console.error(e)}return t}async getJob(e){let t,n="";n=`/${e}`;try{t=await J(this.serverSettings,`jobs${n}`,{method:"GET"})}catch(e){console.error(e)}return t}async getJobs(e,t){let n,o="";t?o=`/${t}`:e&&(o="?"+Object.keys(e).map((t=>{if("sort_by"===t){const t=e.sort_by;return void 0===t?null:t.map((e=>`sort_by=${encodeURIComponent(e.direction)}(${encodeURIComponent(e.name)})`)).join("&")}const n=e[t];return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`})).join("&"));try{n=await J(this.serverSettings,`jobs${o}`,{method:"GET"})}catch(e){console.error(e)}return n}async getjobCount(e){let t={count:0},n="";e&&(n=`?status=${encodeURIComponent(e)}`);try{t=await J(this.serverSettings,`jobs/count${n}`,{method:"GET"})}catch(e){console.error(e)}return t.count}async createJob(e){let t;try{t=await J(this.serverSettings,"jobs",{method:"POST",body:JSON.stringify(e)})}catch(e){console.error(e)}return t}async setJobStatus(e,t){let n;try{n=await J(this.serverSettings,`jobs/${e}`,{method:"PATCH",body:JSON.stringify({status:t})})}catch(e){console.error(e)}return n}async getRuntimeEnvironments(){let e;try{e=await J(this.serverSettings,"runtime_environments",{method:"GET"})}catch(e){console.error(e)}return e}async deleteJob(e){try{await J(this.serverSettings,`jobs/${e}`,{method:"DELETE"})}catch(e){console.error(e)}}}async function J(e,t="",n={},o=!0){const a=C.URLExt.join(e.baseUrl,"scheduler",t);let l;try{l=await y.ServerConnection.makeRequest(a,n,e)}catch(e){throw new y.ServerConnection.NetworkError(e)}let r=await l.text();if(o&&r.length>0)try{r=JSON.parse(r)}catch(e){console.error("Not a JSON response body.",l)}if(!l.ok)throw new y.ServerConnection.ResponseError(l,r.message||r);return r}!function(e){let t;!function(e){e.ASC="asc",e.DESC="desc"}(t=e.SortDirection||(e.SortDirection={}))}(E||(E={}));var k,S=n(1840);class x{constructor(e,t){const n=e?e.filter((e=>"IN_PROGRESS"===e.status)):[];this.inProgressJobCount=n.length,this._scheduled_jobs=e,this.scheduledJobsChanged=new S.Signal(this),this.inProgressJobCountChanged=new S.Signal(this)}updateJobs(e){let t=!1;if(e.length!==this._scheduled_jobs.length&&(t=!0),!t)for(let n=0;n<e.length;n++){const o=e[n],a=this._scheduled_jobs[n];if(o.status!==a.status){t=!0;break}}t&&(this._scheduled_jobs=e,this.scheduledJobsChanged.emit(e))}updatejobCount(e){e!==this.inProgressJobCount&&(this.inProgressJobCount=e,this.inProgressJobCountChanged.emit(e))}}class Z extends r.VDomModel{constructor(e){super(),this._jobsView="ListJobs",this._jobsView=e.jobsView||"ListJobs",this._createJobModel=e.createJobModel||k.emptyCreateModel(),this._listJobsModel=e.listJobsModel||{listJobsView:"Job"},this._jobDetailModel=e.jobDetailModel||{jobId:""},this._jobCount=0}get jobsView(){return this._jobsView}set jobsView(e){this._jobsView=e,this.stateChanged.emit(void 0)}get createJobModel(){return this._createJobModel}set createJobModel(e){this._createJobModel=e,this.stateChanged.emit(void 0)}get listJobsModel(){return this._listJobsModel}set listJobsModel(e){this._listJobsModel=e,this.stateChanged.emit(void 0)}get jobDetailModel(){return this._jobDetailModel}set jobDetailModel(e){this._jobDetailModel=e,this.stateChanged.emit(void 0)}get jobCount(){return this._jobCount}set jobCount(e){this._jobCount=e}}!function(e){e.emptyCreateModel=function(){return{jobName:"",inputFile:"",outputPath:"",environment:""}}}(k||(k={}));var O=n(7313);function I(e){switch(e.level){case 1:default:return a().createElement("h1",{className:"jp-jobs-Heading"},e.children);case 2:return a().createElement("h2",{className:"jp-jobs-Heading"},e.children);case 3:return a().createElement("h3",{className:"jp-jobs-Heading"},e.children)}}function V(e){let t="jp-jobs-Cluster";return t+=` justify-content-${e.justifyContent||"flex-start"}`,t+=` align-items-${e.alignItems||"center"}`,t+=` gap-${e.gap||1}`,a().createElement("div",{className:t},e.children)}var P=n(296);function F(e){return a().createElement("div",{className:`jp-jobs-Stack size-${e.size||1}`},e.children)}function M(e){const t=sessionStorage.getItem("environments");if(null===t)return null;const n=JSON.parse(t).find((t=>t.name===e));return n&&n.output_formats?n.output_formats:null}function D(e){const t=(0,o.useMemo)((()=>M(e.environment)),[e.environment]);return null===t?null:a().createElement(F,{size:2},a().createElement(P.InputLabel,null,e.label),a().createElement(V,{gap:3,justifyContent:"flex-start"},t.map(((t,n)=>a().createElement(P.FormControlLabel,{key:n,control:a().createElement(P.Checkbox,{defaultChecked:e.value.some((e=>t.name===e.name)),id:`${e.id}-${t.name}`,value:t.name,onChange:e.onChange}),label:t.label})))))}var N=n(8085);function L(e){const t=_("jupyterlab");return a().createElement(N.Z,{spacing:2},a().createElement(P.InputLabel,null,e.label),e.value.map(((n,o)=>a().createElement(V,{key:o,justifyContent:"flex-start"},a().createElement(P.TextField,{name:`parameter-${o}-name`,value:n.name,type:"text",placeholder:t.__("Name"),onChange:e.onChange}),a().createElement(P.TextField,{name:`parameter-${o}-value`,value:n.value,type:"text",placeholder:t.__("Value"),onChange:e.onChange}),a().createElement(P.IconButton,{"aria-label":"delete",onClick:()=>(e.removeParameter(o),!1),title:t.__("Delete this parameter")},a().createElement(m.LabIcon.resolveReact,{icon:m.closeIcon,tag:"span"}))))),a().createElement(V,{justifyContent:"flex-start"},a().createElement(P.IconButton,{onClick:t=>(e.addParameter(),!1),title:t.__("Add new parameter")},a().createElement(m.LabIcon.resolveReact,{icon:m.addIcon,tag:"span"}))))}var R=n(6798),$=n(8377),T=n(6351);function q(e){const[t,n]=(0,o.useState)([]),l=_("jupyterlab");if(a().useEffect((()=>{e.environmentsPromise.then((e=>n(e)))}),[]),0===t.length)return a().createElement("em",null,l.__("Loading …"));const r=`${e.id}-label`;return a().createElement(a().Fragment,null,a().createElement(P.InputLabel,{id:r},e.label),a().createElement(P.Select,{labelId:r,name:e.name,id:e.id,onChange:e.onChange,value:e.initialValue},t.map(((e,t)=>a().createElement(P.MenuItem,{value:e.label,title:e.description,key:t},e.name)))))}function A(e){var t,n,o,l;const r=_("jupyterlab"),[i,s]=a().useState({}),[c,u]=a().useState({}),d=Object.keys(c).some((e=>!!c[e])),m=t=>{const n=t.target,o=function(e){const t=e.match(/^parameter-(\d+)-name$/);return null===t?null:parseInt(t[1])}(n.name),a=function(e){const t=e.match(/^parameter-(\d+)-value$/);return null===t?null:parseInt(t[1])}(n.name),l=e.model.parameters||[];if(null!==o)l[o].name=n.value,e.handleModelChange(Object.assign(Object.assign({},e.model),{parameters:l}));else if(null!==a)l[a].value=n.value,e.handleModelChange(Object.assign(Object.assign({},e.model),{parameters:l}));else{const t="checkbox"===n.type?n.checked:n.value,o=n.name;"string"==typeof t&&s(Object.assign(Object.assign({},i),{[o]:t})),e.handleModelChange(Object.assign(Object.assign({},e.model),{[o]:t}))}},b=new w({}),p="jp-create-job-",h=r.__("One or more of the fields has an error.");return a().createElement($.Z,{sx:{p:4}},a().createElement("form",{className:`${p}form`,onSubmit:e=>e.preventDefault()},a().createElement(N.Z,{spacing:4},a().createElement(I,{level:1},"Create Job"),a().createElement(T.Z,{label:r.__("Job name"),variant:"outlined",onChange:m,value:null!==(t=i.jobName)&&void 0!==t?t:e.model.jobName,id:`${p}jobName`,name:"jobName"}),a().createElement(T.Z,{label:r.__("Input file"),variant:"outlined",onChange:m,value:null!==(n=i.inputFile)&&void 0!==n?n:e.model.inputFile,id:`${p}inputFile`,onBlur:e=>(e=>{const t=e.name,n=e.value;u(""===n?Object.assign(Object.assign({},c),{[t]:r.__("You must provide a value.")}):Object.assign(Object.assign({},c),{[t]:""}))})(e.target),error:("inputFile",!!c.inputFile),helperText:null!==(o=c.inputFile)&&void 0!==o?o:"",name:"inputFile"}),a().createElement(T.Z,{label:r.__("Output path"),variant:"outlined",onChange:m,value:null!==(l=i.outputPath)&&void 0!==l?l:e.model.outputPath,id:`${p}outputPath`,name:"outputPath"}),a().createElement(q,{label:r.__("Environment"),name:"environment",id:`${p}environment`,onChange:t=>{const n=t.target;e.handleModelChange(Object.assign(Object.assign({},e.model),{[n.name]:n.value}))},environmentsPromise:(async()=>{const e=sessionStorage.getItem("environments");return null!==e?JSON.parse(e):b.getRuntimeEnvironments().then((e=>(sessionStorage.setItem("environments",JSON.stringify(e)),e)))})(),initialValue:e.model.environment}),a().createElement(D,{label:r.__("Output formats"),name:"outputFormat",id:`${p}outputFormat`,onChange:t=>{const n=M(e.model.environment);if(null===n)return;const o=t.target.value,a=t.target.checked,l=!!e.model.outputFormats&&e.model.outputFormats.some((e=>e.name===o)),r=e.model.outputFormats||[];if(a&&!l){const t=n.find((e=>e.name===o));t&&e.handleModelChange(Object.assign(Object.assign({},e.model),{outputFormats:[...r,t]}))}else!a&&l&&e.handleModelChange(Object.assign(Object.assign({},e.model),{outputFormats:r.filter((e=>e.name!==o))}))},environment:e.model.environment,value:e.model.outputFormats||[]}),a().createElement(L,{label:r.__("Parameters"),name:"parameters",id:`${p}parameters`,value:e.model.parameters||[],onChange:m,addParameter:()=>{const t=e.model.parameters||[];t.push({name:"",value:""}),e.handleModelChange(Object.assign(Object.assign({},e.model),{parameters:t}))},removeParameter:t=>{const n=e.model.parameters||[];n.splice(t,1),e.handleModelChange(Object.assign(Object.assign({},e.model),{parameters:n}))},formPrefix:p}),a().createElement(e.advancedOptions,{jobsView:"CreateJob",model:e.model,handleModelChange:e.handleModelChange,errors:c,handleErrorsChange:u}),a().createElement(V,{gap:3,justifyContent:"flex-end"},a().createElement(R.Z,{variant:"outlined",onClick:e.toggleView},r.__("Cancel")),a().createElement(R.Z,{variant:"contained",onClick:t=>((async t=>{if(d)return void console.error("User attempted to submit a createJob request; button should have been disabled");const n=new w({}),o={name:e.model.jobName,input_uri:e.model.inputFile,output_prefix:e.model.outputPath,runtime_environment_name:e.model.environment};if(void 0!==e.model.parameters){const t={};e.model.parameters.forEach((e=>{const{name:n,value:o}=e;void 0!==t[n]?console.error("Parameter "+n+" already set to "+t[n]+" and is about to be set again to "+o):t[n]=o})),o.parameters=t}void 0!==e.model.outputFormats&&(o.output_formats=e.model.outputFormats.map((e=>e.name))),n.createJob(o).then((t=>{e.toggleView()}))})(),!1),disabled:d,title:d?h:""},r.__("Create"))))))}var Q=n(9144),H=n(9557),B=n(7272);function G(e){if("IN_PROGRESS"!==e.job.status)return null;const t=_("jupyterlab"),n=e.job.name?t.__('Stop "%1"',e.job.name):t.__("Stop job");return a().createElement(r.ToolbarButtonComponent,{onClick:e.clickHandler,tooltip:n,icon:m.stopIcon})}function U(e){const t=_("jupyterlab"),n=e.job.name?t.__('Delete "%1"',e.job.name):t.__("Delete job");return a().createElement(r.ToolbarButtonComponent,{onClick:e.clickHandler,tooltip:n,icon:m.closeIcon})}function z(e){const t=_("jupyterlab"),n=e.job.name?t.__('Rerun "%1" …',e.job.name):t.__("Rerun job …"),o=void 0!==e.job.parameters?Object.keys(e.job.parameters).map((t=>function(t){var n;return{name:t,value:null===(n=e.job.parameters)||void 0===n?void 0:n[t]}}(t))):void 0;return a().createElement(r.ToolbarButtonComponent,{onClick:()=>{var t;const n={inputFile:e.job.input_uri,jobName:null!==(t=e.job.name)&&void 0!==t?t:"",outputPath:e.job.output_prefix,environment:e.job.runtime_environment_name,parameters:o},a=e.job.output_formats,l=M(e.job.runtime_environment_name);a&&l&&(n.outputFormats=l.filter((e=>a.some((t=>e.name===t))))),e.showCreateJob(n)},tooltip:n,icon:v})}function W(e){const t=e.job.create_time?new Date(e.job.create_time):null,n=t?t.toLocaleString():null;return a().createElement(a().Fragment,null,n)}function Y(e){if("COMPLETED"!==e.job.status)return null;const t=_("jupyterlab"),n=e.job.output_formats||["ipynb"];return a().createElement(a().Fragment,null,n.map((n=>{const o=e.job.output_uri.replace(/ipynb$/,n);return a().createElement("a",{key:n,href:`/lab/tree/${o}`,title:t.__('Open "%1"',o),onClick:t=>e.openOnClick(t,o),style:{paddingRight:"1em"}},n)})))}var K=n(2097),X=n(7542),ee=n(7929),te=n(5369),ne=n(6948),oe=n(5218),ae=n(8881);function le(e){const[t,n]=(0,o.useState)(void 0),[l,r]=(0,o.useState)({}),[i,s]=(0,o.useState)(new Set),[c,u]=(0,o.useState)(0),[d,m]=(0,o.useState)(0),[b,p]=(0,o.useState)(!1),h=(0,K.Z)(),v=(0,o.useCallback)((e=>{s((t=>new Set([...t,e])))}),[]),g=async()=>{u(0),m(0),p(!0);const t=await e.getJobs(l);p(!1),n(t)};(0,o.useEffect)((()=>{g()}),[l]);const j=_("jupyterlab"),f=a().createElement(V,{justifyContent:"flex-end"},a().createElement(R.Z,{variant:"contained",size:"small",onClick:()=>g()},j.__("Reload"))),E=(0,o.useCallback)((e=>{switch(e){case"CREATED":return j.__("Created");case"QUEUED":return j.__("Queued");case"COMPLETED":return j.__("Completed");case"FAILED":return j.__("Failed");case"IN_PROGRESS":return j.__("In progress");case"STOPPED":return j.__("Stopped");case"STOPPING":return j.__("Stopping")}}),[j]);if(void 0===t)return a().createElement("p",null,a().createElement("em",null,j.__("Loading …")));if(!(null==t?void 0:t.jobs.length))return a().createElement(a().Fragment,null,f,a().createElement("p",{className:"jp-notebook-job-list-empty"},j.__("There are no notebook jobs. Right-click on a file in the file browser to run or schedule a notebook as a job.")));const y=[{sortField:"name",name:j.__("Job name")},{sortField:"input_uri",name:j.__("Input file")},{sortField:null,name:j.__("Output files")},{sortField:"create_time",name:j.__("Created at")},{sortField:"status",name:j.__("Status")},{sortField:null,name:j.__("Actions")}],w=t.jobs.slice(25*c,25*(c+1)).filter((e=>!i.has(e.job_id))).map((t=>function(e,t,n,o,l,r){const i=[a().createElement("a",{onClick:()=>r(e.job_id)},e.name),(s=e.input_uri,C.PathExt.basename(s)),a().createElement(Y,{job:e,openOnClick:(e,n)=>{e.preventDefault(),t.commands.execute("docmanager:open",{path:n})}}),a().createElement(W,{job:e}),l(e.status),a().createElement(Q.Z,{spacing:1,direction:"row"},a().createElement(G,{job:e,clickHandler:()=>t.commands.execute(we.stopJob,{id:e.job_id})}),a().createElement(U,{job:e,clickHandler:()=>{t.commands.execute(we.deleteJob,{id:e.job_id}),o(e.job_id)}}),a().createElement(z,{job:e,showCreateJob:n}))];var s;return a().createElement(H.Z,null,i.map(((e,t)=>a().createElement(B.Z,{key:t},e))))}(t,e.app,e.showCreateJob,v,E,e.showDetailView)));return a().createElement(a().Fragment,null,f,a().createElement("div",{style:{flex:1,height:0}},a().createElement(ee.Z,{component:ae.Z,sx:Object.assign({height:"100%"},b?{pointerEvents:"none",opacity:.5}:{})},a().createElement(X.Z,{stickyHeader:!0},a().createElement(te.Z,null,y.map(((e,t)=>a().createElement(se,{key:t,gridColumn:e,jobsQuery:l,setJobsQuery:r})))),a().createElement(ne.Z,null,w)),a().createElement(oe.Z,{component:"div",sx:{position:"sticky",bottom:0,backgroundColor:h.palette.background.paper,borderTop:`1px solid ${h.palette.divider}`},count:t.total_count,page:c,onPageChange:async(o,a)=>{a<=d?u(a):(await(async o=>{if(void 0===o)return;p(!0);const a=await e.getJobs(Object.assign(Object.assign({},l),{next_token:o}));p(!1),a&&n({jobs:[...(null==t?void 0:t.jobs)||[],...(null==a?void 0:a.jobs)||[]],next_token:a.next_token,total_count:a.total_count})})(t.next_token),u(a),m(a))},nextIconButtonProps:{disabled:c===d&&!t.next_token},rowsPerPage:25,rowsPerPageOptions:[25]}))))}const re=a().createElement(m.LabIcon.resolveReact,{icon:m.caretUpIcon,tag:"span"}),ie=a().createElement(m.LabIcon.resolveReact,{icon:m.caretDownIcon,tag:"span"});function se(e){const t=e.jobsQuery.sort_by,n=null==t?void 0:t[0],o=n&&n.name===e.gridColumn.sortField,l=o&&n&&n.direction===E.SortDirection.ASC,r=o&&n&&n.direction===E.SortDirection.DESC;return a().createElement(B.Z,{onClick:()=>{if(!e.gridColumn.sortField)return;const n=l?E.SortDirection.DESC:E.SortDirection.ASC,o=[{name:e.gridColumn.sortField,direction:n},...(t||[]).filter((t=>t.name!==e.gridColumn.sortField))];e.setJobsQuery(Object.assign(Object.assign({},e.jobsQuery),{sort_by:o}))},sx:e.gridColumn.sortField?{cursor:"pointer"}:{}},e.gridColumn.name,l&&re,r&&ie)}function ce(e){const t=new w({});return void 0===e.max_items&&(e.max_items=25),t.getJobs(e)}function ue(e){const t=_("jupyterlab");return a().createElement($.Z,{sx:{p:4},style:{height:"100%",boxSizing:"border-box"}},a().createElement(N.Z,{spacing:3,style:{height:"100%"}},a().createElement(I,{level:1},t.__("Notebook Jobs")),a().createElement(le,{showHeaders:!0,app:e.app,showCreateJob:e.showCreateJob,getJobs:ce,showDetailView:e.showDetailView})))}var de=n(120),me=n(8715),be=n(14),pe=n(5821);function he(e){const[t,n]=(0,o.useState)(!0),[l,r]=(0,o.useState)(void 0),i=_("jupyterlab"),s=new w({}),c=async()=>{const t=await s.getJob(e.model.jobId);r(t),n(!1)},u=()=>{var t,n,o,a,r;const i={inputFile:null!==(t=null==l?void 0:l.input_uri)&&void 0!==t?t:"",jobName:null!==(n=null==l?void 0:l.name)&&void 0!==n?n:"",outputPath:null!==(o=null==l?void 0:l.output_prefix)&&void 0!==o?o:"",environment:null!==(a=null==l?void 0:l.runtime_environment_name)&&void 0!==a?a:"",parameters:l&&l.parameters?Object.keys(l.parameters).map((e=>(e=>{var t;return{name:e,value:null===(t=null==l?void 0:l.parameters)||void 0===t?void 0:t[e]}})(e))):void 0,outputFormats:null===(r=null==l?void 0:l.output_formats)||void 0===r?void 0:r.map((e=>({name:e,label:e})))};e.setCreateJobModel(i),e.setView("CreateJob")},d=async()=>{var t;await s.deleteJob(null!==(t=null==l?void 0:l.job_id)&&void 0!==t?t:""),e.setView("ListJobs")},b=async()=>{e.app.commands.execute("scheduling:stop-job",{id:null==l?void 0:l.job_id}),c()},p=e=>{if(""===e)return"";{const t=new Date(e);return t?t.toLocaleString():""}};function h(e){return a().createElement(P.TextField,Object.assign({},e,{label:e.label,defaultValue:e.defaultValue,variant:"outlined",disabled:!0}))}return(0,o.useEffect)((()=>{c()}),[]),a().createElement(a().Fragment,null,a().createElement(de.Z,{sx:{maxWidth:"500px",p:4}},a().createElement(Q.Z,{spacing:4},a().createElement("div",{role:"presentation"},a().createElement(me.Z,{"aria-label":"breadcrumb"},a().createElement(be.Z,{underline:"hover",color:"inherit",onClick:t=>e.setView("ListJobs")},i.__("Notebook Jobs")),a().createElement(P.Typography,{color:"text.primary"},e.model.jobId))),a().createElement(I,{level:1},i.__("Job Detail")),a().createElement((function(){var e,n,o,r,s,c,v,g,_,j;return t?a().createElement(Q.Z,{direction:"row",justifyContent:"center"},a().createElement(P.CircularProgress,{title:i.__("Loading")})):a().createElement(a().Fragment,null,a().createElement(Q.Z,{direction:"row",spacing:1,justifyContent:"flex-end"},"IN_PROGRESS"===(null==l?void 0:l.status)&&a().createElement(R.Z,{variant:"outlined",onClick:b},i.__("Stop Job")),a().createElement(R.Z,{variant:"outlined",onClick:u},i.__("Rerun Job")),a().createElement(R.Z,{variant:"contained",color:"error",onClick:d},i.__("Delete Job"))),a().createElement(Q.Z,{spacing:4},a().createElement(h,{label:i.__("Job name"),defaultValue:null!==(e=null==l?void 0:l.name)&&void 0!==e?e:""}),a().createElement(h,{label:i.__("Input file"),defaultValue:null!==(n=null==l?void 0:l.input_uri)&&void 0!==n?n:""}),a().createElement(h,{label:i.__("Output path"),defaultValue:null!==(o=null==l?void 0:l.output_uri)&&void 0!==o?o:""}),a().createElement(h,{label:i.__("Environment"),defaultValue:null!==(r=null==l?void 0:l.runtime_environment_name)&&void 0!==r?r:""}),a().createElement(h,{label:i.__("Status"),defaultValue:null!==(s=null==l?void 0:l.status)&&void 0!==s?s:""}),a().createElement(P.FormControl,{component:"fieldset"},a().createElement(P.FormLabel,{component:"legend"},i.__("Output formats")),a().createElement(P.FormGroup,{style:{display:"flex",flexDirection:"row"}},(null==l?void 0:l.output_formats)&&(null==l?void 0:l.output_formats.map((e=>a().createElement(P.FormControlLabel,{key:e,control:a().createElement(P.Checkbox,{checked:!0,disabled:!0}),label:e})))))),a().createElement(pe.Z,{defaultExpanded:!0},a().createElement(P.AccordionSummary,{expandIcon:a().createElement(m.caretDownIcon.react,null),"aria-controls":"panel-content",id:"panel-header"},a().createElement(P.FormLabel,{component:"legend"},i.__("Parameters"))),a().createElement(P.AccordionDetails,{id:"panel-content"},a().createElement(Q.Z,{spacing:4},Object.entries(null!==(c=null==l?void 0:l.parameters)&&void 0!==c?c:{}).map((([e,t])=>a().createElement(Q.Z,{key:e,direction:"row",spacing:1},a().createElement(h,{label:i.__("Parameter"),defaultValue:e,InputProps:{readOnly:!0}}),a().createElement(h,{label:i.__("Value"),defaultValue:t})))))))),a().createElement(pe.Z,{defaultExpanded:!0},a().createElement(P.AccordionSummary,{expandIcon:a().createElement(m.caretDownIcon.react,null),"aria-controls":"panel-content",id:"panel-header"},a().createElement(P.FormLabel,{component:"legend"},i.__("Additional options"))),a().createElement(P.AccordionDetails,{id:"panel-content"},a().createElement(Q.Z,{spacing:4},a().createElement(h,{label:i.__("Idempotency token"),defaultValue:null!==(v=null==l?void 0:l.idempotency_token)&&void 0!==v?v:""}),a().createElement(P.FormLabel,{component:"legend"},i.__("Tags")),(null==l?void 0:l.tags)&&(null==l?void 0:l.tags.map((e=>a().createElement(h,{label:i.__("Tag"),defaultValue:e,InputProps:{readOnly:!0}})))),a().createElement(h,{label:i.__("Create time"),defaultValue:p(null!==(g=null==l?void 0:l.create_time)&&void 0!==g?g:"")}),a().createElement(h,{label:i.__("Start time"),defaultValue:p(null!==(_=null==l?void 0:l.start_time)&&void 0!==_?_:"")}),a().createElement(h,{label:i.__("End time"),defaultValue:p(null!==(j=null==l?void 0:l.end_time)&&void 0!==j?j:"")})))),a().createElement(pe.Z,{defaultExpanded:!0},a().createElement(P.AccordionSummary,{expandIcon:a().createElement(m.caretDownIcon.react,null),"aria-controls":"panel-content",id:"panel-header"},a().createElement(P.FormLabel,{component:"legend"},i.__("Advanced options"))),a().createElement(P.AccordionDetails,{id:"panel-content"},a().createElement(Q.Z,{component:"form",spacing:4},"Placeholder"))))}),null))))}var ve=n(2092);function ge(e){return getComputedStyle(document.body).getPropertyValue(e).trim()}function _e(){const e=document.body.getAttribute("data-jp-theme-light");return(0,ve.Z)({spacing:4,palette:{mode:"true"===e?"light":"dark",primary:{main:ge("--jp-brand-color1")},text:{primary:ge("--jp-ui-font-color1"),secondary:ge("--jp-ui-font-color2"),disabled:ge("--jp-ui-font-color3")}},typography:{fontFamily:ge("--jp-ui-font-family"),fontSize:12,htmlFontSize:16,button:{textTransform:"capitalize"}}})}class je extends r.VDomRenderer{constructor(e){var t,n,o;super(e.model||new Z({})),this.addClass("jp-notebook-jobs-panel");const a=e.translator.load("jupyterlab");this.title.icon=null!==(t=e.titleIcon)&&void 0!==t?t:p,this.title.caption=null!==(n=e.title)&&void 0!==n?n:a.__("Notebook Jobs"),this._description=null!==(o=e.description)&&void 0!==o?o:a.__("Job Runs"),this._app=e.app,this._translator=e.translator,this._advancedOptions=e.advancedOptions,this.node.setAttribute("role","region"),this.node.setAttribute("aria-label",a.__("Notebook Jobs"))}toggleView(){"CreateJob"!==this.model.jobsView&&"ListJobs"!==this.model.jobsView||(this.model.jobsView="ListJobs"===this.model.jobsView?"CreateJob":"ListJobs")}showDetailView(e){this.model.jobsView="JobDetail",this.model.jobDetailModel.jobId=e}render(){return a().createElement(O.ThemeProvider,{theme:_e()},a().createElement(g.Provider,{value:this._translator},"CreateJob"===this.model.jobsView&&a().createElement(A,{model:this.model.createJobModel,handleModelChange:e=>this.model.createJobModel=e,toggleView:this.toggleView.bind(this),advancedOptions:this._advancedOptions}),"ListJobs"===this.model.jobsView&&a().createElement(ue,{app:this._app,model:this.model.listJobsModel,handleModelChange:e=>this.model.listJobsModel=e,showCreateJob:e=>{this.model.createJobModel=e,this.model.jobsView="CreateJob"},showDetailView:this.showDetailView.bind(this)}),"JobDetail"===this.model.jobsView&&a().createElement(he,{app:this._app,model:this.model.jobDetailModel,handleModelChange:e=>this.model.jobDetailModel=e,setCreateJobModel:e=>this.model.createJobModel=e,setView:e=>this.model.jobsView=e})))}}var fe,Ee=n(1526);!function(e){e.IAdvancedOptions=new Ee.Token("@jupyterlab/scheduler:IAdvancedOptions")}(fe||(fe={}));const Ce=fe,ye=e=>a().createElement(a().Fragment,null);var we;!function(e){e.deleteJob="scheduling:delete-job",e.runNotebook="scheduling:run-notebook",e.showNotebookJobs="scheduling:show-notebook-jobs",e.stopJob="scheduling:stop-job"}(we||(we={}));const Je="notebook-jobs-panel",ke={id:"@jupyterlab/scheduler:plugin",requires:[i.IFileBrowserFactory,u.ITranslator,l.ILayoutRestorer,Ce.IAdvancedOptions],optional:[c.IStatusBar,s.ILauncher],autoStart:!0,activate:async function(e,t,n,o,l,i,s){if(!i)return;const{commands:c}=e,u=n.load("jupyterlab"),{tracker:m}=t,v=new w({}),g=new r.WidgetTracker({namespace:"jupyterlab-scheduler"});let _,j;o.restore(g,{command:we.showNotebookJobs,name:()=>"jupyterlab-scheduler"}),c.addCommand(we.deleteJob,{execute:async e=>{const t=e.id;await v.deleteJob(t)},label:u.__("Delete Job")});const E=async t=>{_&&!_.isDisposed||(j=new je({app:e,translator:n,advancedOptions:l}),_=new r.MainAreaWidget({content:j}),_.content.model.jobsView=t,_.id=Je,_.title.icon=p,_.title.label=u.__("Notebook Jobs"),_.title.closable=!0),g.has(_)||g.add(_),_.isAttached||e.shell.add(_,"main"),_.content.model.jobsView=t,_.content.update(),e.shell.activateById(_.id)};if(c.addCommand(we.showNotebookJobs,{execute:async()=>E("ListJobs"),label:u.__("Notebook Jobs"),icon:h}),c.addCommand(we.runNotebook,{execute:async()=>{var e,t;await E("CreateJob");const n=null==j?void 0:j.model;if(!n)return;const o=m.currentWidget,a=null!==(e=function(e){const t=xe(e);return null===t?null:t.path}(o))&&void 0!==e?e:"",l=null!==(t=function(e){const t=xe(e);return null===t?null:t.name}(o))&&void 0!==t?t:"",r={inputFile:a,jobName:l,outputPath:"",environment:""};n.createJobModel=r},label:u.__("Create Notebook Job"),icon:b}),c.addCommand(we.stopJob,{execute:async e=>{const t=e.id;await v.setJobStatus(t,"STOPPED")},label:u.__("Stop Job")}),!i)return;const C=await Oe();i.registerStatusItem("jupyterlab-scheduler:status",{align:"middle",item:r.ReactWidget.create(a().createElement(f,{onClick:async()=>E("ListJobs"),model:C}))}),new d.Poll({factory:async()=>{const e=null==j?void 0:j.model;if(!e)return;const t=await v.getjobCount("IN_PROGRESS");e.jobCount=t},frequency:{interval:1e3,backoff:!1}}).start(),s&&s.add({command:we.showNotebookJobs})}},Se={id:"@jupyterlab/scheduler:IAdvancedOptions",autoStart:!0,provides:Ce.IAdvancedOptions,activate:e=>ye};function xe(e){if(null===e)return null;const t=e.selectedItems().next();return null==t?null:t}let Ze=null;async function Oe(){if(Ze)return Ze;const e=new w({}),t=await e.getJobs({});return Ze=new x(t.jobs),Ze}const Ie=[ke,Se]},8377:(e,t,n)=>{n.d(t,{Z:()=>o});const o=(0,n(1354).Z)()},8085:(e,t,n)=>{n.d(t,{Z:()=>o});const o=(0,n(1819).Z)()},1819:(e,t,n)=>{n.d(t,{Z:()=>y});var o=n(9756),a=n(2122),l=n(6271),r=n(6010),i=n(9766),s=n(4780),c=n(4867),u=n(3264),d=n(9628),m=n(9707),b=n(360),p=n(5408),h=n(1974),v=n(5893);const g=["component","direction","spacing","divider","children","className"],_=(0,b.Z)(),j=(0,u.Z)("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root});function f(e){return(0,d.Z)({props:e,name:"MuiStack",defaultTheme:_})}function E(e,t){const n=l.Children.toArray(e).filter(Boolean);return n.reduce(((e,o,a)=>(e.push(o),a<n.length-1&&e.push(l.cloneElement(t,{key:`separator-${a}`})),e)),[])}const C=({ownerState:e,theme:t})=>{let n=(0,a.Z)({display:"flex",flexDirection:"column"},(0,p.k9)({theme:t},(0,p.P$)({values:e.direction,breakpoints:t.breakpoints.values}),(e=>({flexDirection:e}))));if(e.spacing){const o=(0,h.hB)(t),a=Object.keys(t.breakpoints.values).reduce(((t,n)=>(("object"==typeof e.spacing&&null!=e.spacing[n]||"object"==typeof e.direction&&null!=e.direction[n])&&(t[n]=!0),t)),{}),l=(0,p.P$)({values:e.direction,base:a}),r=(0,p.P$)({values:e.spacing,base:a});"object"==typeof l&&Object.keys(l).forEach(((e,t,n)=>{if(!l[e]){const o=t>0?l[n[t-1]]:"column";l[e]=o}}));const s=(t,n)=>{return{"& > :not(style) + :not(style)":{margin:0,[`margin${a=n?l[n]:e.direction,{row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[a]}`]:(0,h.NA)(o,t)}};var a};n=(0,i.Z)(n,(0,p.k9)({theme:t},r,s))}return n=(0,p.dt)(t.breakpoints,n),n};function y(e={}){const{createStyledComponent:t=j,useThemeProps:n=f,componentName:i="MuiStack"}=e,u=t(C);return l.forwardRef((function(e,t){const l=n(e),d=(0,m.Z)(l),{component:b="div",direction:p="column",spacing:h=0,divider:_,children:j,className:f}=d,C=(0,o.Z)(d,g),y={direction:p,spacing:h},w=(0,s.Z)({root:["root"]},(e=>(0,c.Z)(i,e)),{});return(0,v.jsx)(u,(0,a.Z)({as:b,ownerState:y,ref:t,className:(0,r.Z)(w.root,f)},C,{children:_?E(j,_):j}))}))}},1354:(e,t,n)=>{n.d(t,{Z:()=>b});var o=n(2122),a=n(9756),l=n(6271),r=n(6010),i=n(8883),s=n(6523),c=n(9707),u=n(6682),d=n(5893);const m=["className","component"];function b(e={}){const{defaultTheme:t,defaultClassName:n="MuiBox-root",generateClassName:b,styleFunctionSx:p=s.Z}=e,h=(0,i.ZP)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(p);return l.forwardRef((function(e,l){const i=(0,u.Z)(t),s=(0,c.Z)(e),{className:p,component:v="div"}=s,g=(0,a.Z)(s,m);return(0,d.jsx)(h,(0,o.Z)({as:v,ref:l,className:(0,r.Z)(p,b?b(n):n),theme:i},g))}))}}}]);