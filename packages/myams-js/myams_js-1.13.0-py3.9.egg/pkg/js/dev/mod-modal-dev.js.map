{"version":3,"sources":["mod-modal.js"],"names":["$","MyAMS","_initialized","modalToggleEventHandler","evt","Promise","resolve","reject","source","currentTarget","handlers","data","attr","hasClass","stopPropagation","preventDefault","tooltip","modal","open","then","modalShownEventHandler","zIndexModal","dialog","target","visibleModalsCount","length","zIndex","css","setTimeout","not","first","addClass","off","on","handler","modalDismissEventHandler","core","executeFunctionByName","document","dynamicModalShowEventHandler","config","initContent","dynamicModalShownEventHandler","require","form","setFocus","parents","confirmChangedForm","status","modalHiddenEventHandler","fn","Constructor","prototype","_checkScrollbar","_setScrollbar","dynamicModalHiddenEventHandler","clearContent","remove","init","ajaxNav","options","sourceData","url","amsUrl","urlGetter","getFunctionByName","startsWith","ajax","type","cache","amsAllowCache","undefined","request","response","getResponse","dataType","contentType","result","content","dialogData","dialogOptions","settings","handleJSON","wrap","parent","backdrop","keyboard","extend","amsOptions","amsInit","append","stats","amsLogEvent","logPageview","close","element","objectOrParentWithClass","env","bundle","modules","push","console","debug"],"mappings":"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","sourcesContent":["/* global MyAMS */\n/**\n * MyAMS modal dialogs support\n */\n\nconst $ = MyAMS.$;\n\n\nlet _initialized = false;\n\n\n/*\n * Standard data-toggle=\"modal\" handler\n */\nexport function modalToggleEventHandler(evt) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst\n\t\t\tsource = $(evt.currentTarget),\n\t\t\thandlers = source.data('ams-disabled-handlers');\n\t\tif (source.attr('disabled') ||\n\t\t\tsource.hasClass('disabled') ||\n\t\t\t(handlers === true) ||\n\t\t\t(handlers === 'click') ||\n\t\t\t(handlers === 'all')) {\n\t\t\tresolve(false);\n\t\t\treturn;\n\t\t}\n\t\tif (source.data('ams-context-menu') === true) {\n\t\t\tresolve(false);\n\t\t\treturn;\n\t\t}\n\t\tif (source.data('ams-stop-propagation') === true) {\n\t\t\tevt.stopPropagation();\n\t\t}\n\t\tevt.preventDefault();\n\t\tsource.tooltip('hide');\n\t\tMyAMS.modal.open(source).then(() => {\n\t\t\tresolve(true);\n\t\t}, reject);\n\t});\n}\n\n/**\n * Standard modal shown event handler\n * This handler is used to allow modals stacking\n */\nexport function modalShownEventHandler(evt) {\n\n\tconst zIndexModal = 1100;\n\n\t// Enable modals stacking\n\tconst\n\t\tdialog = $(evt.target),\n\t\tvisibleModalsCount = $('.modal:visible').length,\n\t\tzIndex = zIndexModal + (100 * visibleModalsCount);\n\tdialog.css('z-index', zIndex);\n\tsetTimeout(() => {\n\t\t$('.modal-backdrop').not('.modal-stack')\n\t\t\t.first()\n\t\t\t.css('z-index', zIndex - 10)\n\t\t\t.addClass('modal-stack');\n\t}, 0);\n\t// Check form contents before closing modals\n\t$(dialog).off('click', '[data-dismiss=\"modal\"]')\n\t\t.on('click', '[data-dismiss=\"modal\"]', (evt) => {\n\t\t\tconst handler = $(evt.currentTarget).data('ams-dismiss-handler') || modalDismissEventHandler;\n\t\t\treturn MyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t});\n}\n\n\n/**\n * Dynamic modal 'show' callback\n * This callback is used to initialize modal's viewport size\n *\n * @param evt: source event\n */\nexport function dynamicModalShowEventHandler(evt) {\n\tconst dialog = $(evt.target);\n\treturn MyAMS.core.executeFunctionByName(dialog.data('ams-init-content') ||\n\t\tMyAMS.config.initContent, document, dialog);\n}\n\n\n/**\n * Dynamic modal 'shown' callback\n * This callback is used to set focus on first modal input\n *\n * @param evt: source event\n */\nexport function dynamicModalShownEventHandler(evt) {\n\treturn new Promise((resolve, reject) => {\n\t\tMyAMS.require('form').then(() => {\n\t\t\tconst modal = $(evt.target);\n\t\t\tMyAMS.form.setFocus(modal);\n\t\t\tresolve(modal);\n\t\t}, reject);\n\t});\n}\n\n\n/**\n * Modal dismiss handler\n */\nexport function modalDismissEventHandler(evt) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst\n\t\t\tsource = $(evt.currentTarget),\n\t\t\tdialog = source.parents('.modal').first();\n\t\tdialog.data('modal-result', $(evt.currentTarget).data('modal-dismiss-value'));\n\t\tif (MyAMS.form) {\n\t\t\tMyAMS.form.confirmChangedForm(dialog).then((status) => {\n\t\t\t\tif (status === 'success') {\n\t\t\t\t\tdialog.modal('hide');\n\t\t\t\t}\n\t\t\t}).then(resolve, reject);\n\t\t} else {\n\t\t\tdialog.modal('hide');\n\t\t\tresolve();\n\t\t}\n\t});\n}\n\n\n/**\n * Standard modal hidden event handler\n *\n * If several visible modals are still, a \"modal-open\" class is added to body to ensure\n * modals are still visible.\n */\nexport function modalHiddenEventHandler() {\n\tif ($('.modal:visible').length > 0) {\n\t\t$.fn.modal.Constructor.prototype._checkScrollbar();\n\t\t$.fn.modal.Constructor.prototype._setScrollbar();\n\t\t$('body').addClass('modal-open');\n\t}\n}\n\n\n/**\n * Dynamic modal 'hidden' callback\n * This callback is used to clear and remove dynamic modals\n *\n * @param evt: source event\n */\nexport function dynamicModalHiddenEventHandler(evt) {\n\tconst dialog = $(evt.target);\n\tMyAMS.core.executeFunctionByName(dialog.data('ams-clear-content') ||\n\t\tMyAMS.config.clearContent, document, dialog).then(() => {\n\t\tif (dialog.data('dynamic') === true) {\n\t\t\tdialog.remove();\n\t\t}\n\t});\n}\n\n\n/**\n * Main modal module definition\n */\nexport const modal = {\n\n\tinit: () => {\n\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\n\t\tif (MyAMS.config.ajaxNav) {\n\t\t\t// Initialize modal dialogs links\n\t\t\t// Standard Bootstrap handlers are removed!!\n\t\t\t$(document).off('click', '[data-toggle=\"modal\"]')\n\t\t\t\t.on('click', '[data-toggle=\"modal\"]', (evt) => {\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\tconst handler = $(evt.currentTarget).data('ams-modal-handler') || modalToggleEventHandler;\n\t\t\t\t\tMyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t\t\t});\n\t\t}\n\n\t\t// Handle modal shown event to allow modals stacking\n\t\t$(document).on('shown.bs.modal', '.modal', (evt) => {\n\t\t\tconst handler = $(evt.currentTarget).data('ams-shown-handler') || modalShownEventHandler;\n\t\t\tMyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t});\n\n\t\t// Handle modal hidden event to check remaining modals\n\t\t$(document).on('hidden.bs.modal', '.modal', (evt) => {\n\t\t\tconst handler = $(evt.currentTarget).data('ams-hidden-handler') || modalHiddenEventHandler;\n\t\t\tMyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t});\n\t},\n\n\topen: (source, options) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet sourceData = {},\n\t\t\t\turl = source;\n\t\t\tif (typeof source !== 'string') {\n\t\t\t\tsourceData = source.data();\n\t\t\t\turl = source.attr('href') || sourceData.amsUrl;\n\t\t\t}\n\t\t\tconst urlGetter = MyAMS.core.getFunctionByName(url);\n\t\t\tif (typeof urlGetter === 'function') {\n\t\t\t\turl = urlGetter(source);\n\t\t\t}\n\t\t\tif (!url) {\n\t\t\t\treject(\"No provided URL!\");\n\t\t\t}\n\t\t\tif (url.startsWith('#')) {  // Open inner modal\n\t\t\t\t$(url).modal('show');\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype: 'get',\n\t\t\t\t\turl: url,\n\t\t\t\t\tcache: sourceData.amsAllowCache === undefined ? false : sourceData.amsAllowCache,\n\t\t\t\t\tdata: options\n\t\t\t\t}).then((data, status, request) => {\n\t\t\t\t\tlet modal = null;\n\t\t\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\t\t\tconst\n\t\t\t\t\t\t\tresponse = MyAMS.ajax.getResponse(request),\n\t\t\t\t\t\t\tdataType = response.contentType,\n\t\t\t\t\t\t\tresult = response.data;\n\t\t\t\t\t\tlet content,\n\t\t\t\t\t\t\tdialog,\n\t\t\t\t\t\t\tdialogData,\n\t\t\t\t\t\t\tdialogOptions,\n\t\t\t\t\t\t\tsettings;\n\t\t\t\t\t\tswitch (dataType) {\n\t\t\t\t\t\t\tcase 'json':\n\t\t\t\t\t\t\t\tMyAMS.ajax.handleJSON(result,\n\t\t\t\t\t\t\t\t\t$($(source).data('ams-json-target') || '#content'));\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'script':\n\t\t\t\t\t\t\tcase 'xml':\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'html':\n\t\t\t\t\t\t\tcase 'text':\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tcontent = $(result),\n\t\t\t\t\t\t\t\tdialog = $('.modal-dialog', content.wrap('<div></div>').parent()),\n\t\t\t\t\t\t\t\tdialogData = dialog.data() || {},\n\t\t\t\t\t\t\t\tdialogOptions = {\n\t\t\t\t\t\t\t\t\tbackdrop: dialogData.backdrop === undefined ? 'static' : dialogData.backdrop,\n\t\t\t\t\t\t\t\t\tkeyboard: dialogData.keyboard === undefined ? true : dialogData.keyboard\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tsettings = $.extend({}, dialogOptions, dialogData.amsOptions);\n\t\t\t\t\t\t\t\tsettings = MyAMS.core.executeFunctionByName(dialogData.amsInit, dialog, settings) || settings;\n\t\t\t\t\t\t\t\tmodal = $('<div>').addClass('modal fade')\n\t\t\t\t\t\t\t\t\t.attr('tabIndex', '-1')\n\t\t\t\t\t\t\t\t\t.data('dynamic', true)\n\t\t\t\t\t\t\t\t\t.append(content)\n\t\t\t\t\t\t\t\t\t.on('show.bs.modal', dynamicModalShowEventHandler)\n\t\t\t\t\t\t\t\t\t.on('shown.bs.modal', dynamicModalShownEventHandler)\n\t\t\t\t\t\t\t\t\t.on('hidden.bs.modal', dynamicModalHiddenEventHandler)\n\t\t\t\t\t\t\t\t\t.modal(settings);\n\t\t\t\t\t\t\t\tif (MyAMS.stats &&\n\t\t\t\t\t\t\t\t\t!((sourceData.amsLogEvent === false) ||\n\t\t\t\t\t\t\t\t\t\t(dialogData.amsLogEvent === false))) {\n\t\t\t\t\t\t\t\t\tMyAMS.stats.logPageview(url);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tresolve(modal);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Close modal associated with given element\n\t *\n\t * @param element: the element contained into closed modal\n\t */\n\tclose: (element) => {\n\t\tif (typeof element === 'string') {\n\t\t\telement = $(element);\n\t\t} else if (typeof element === 'undefined') {\n\t\t\telement = $('.modal-dialog:last');\n\t\t}\n\t\tconst dialog = element.objectOrParentWithClass('modal');\n\t\tif (dialog.length > 0) {\n\t\t\tdialog.modal('hide');\n\t\t}\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (MyAMS.env.bundle) {\n\tMyAMS.config.modules.push('modal');\n} else {\n\tMyAMS.modal = modal;\n\tconsole.debug(\"MyAMS: modal module loaded...\");\n}\n"],"file":"mod-modal-dev.js"}