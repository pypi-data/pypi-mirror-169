# 零、前言

## 前言

几年前，我在亚马逊上搜索了一本基于 Python 的应用安全书籍。我以为会有多本书可供选择。已经有很多关于性能、机器学习和 web 开发等主题的 Python 书籍。

令我惊讶的是，我要找的书并不存在。我找不到一本关于我和同事们正在解决的日常问题的书。我们如何确保所有网络流量都经过加密？我们应该使用哪些框架来保护 web 应用程序？我们应该用什么算法对数据进行哈希或签名？

在接下来的几年里，我和我的同事们找到了这些问题的答案，同时选定了一套标准的开源工具和最佳实践。在此期间，我们设计并实施了多个系统，保护了数百万新终端用户的数据和隐私。与此同时，三家竞争对手遭到黑客攻击。

和世界上其他人一样，我的生活在 2020 年初发生了变化。每一个标题都是关于新冠肺炎的，突然间远程工作成了新常态。我认为公平地说，每个人对疫情都有自己独特的反应；对我来说，这是严重的无聊。

写这本书让我一举两得。首先，在疫情被封锁的一年里，这是一个打发无聊的好方法。作为硅谷的居民，这种一线希望在 2020 年秋天被放大。此时，附近的一系列野火破坏了该州大部分地区的空气质量，使许多居民被困在家中。

第二，也是更重要的一点，写这本书让我感到非常满足。像许多硅谷的创业公司一样，很多书开始只是为了获得一个头衔，比如*作者*或*创始人*。但是，如果一家初创公司或一本书想要为他人创造价值，就必须解决现实世界的问题。

我希望这本书能够帮助你解决现实世界中的许多安全问题。

## 致谢

写作需要大量的独自努力。因此很容易忘记是谁帮助了你。我想感谢以下帮助我的人(按我遇见他们的顺序)。

凯瑟琳·伯克维兹，感谢你成为世界上最好的高中英语老师。很抱歉我是个麻烦制造者。我的思想放弃者朋友阿米特·拉索尔，谢谢你把我介绍给曼宁。我要感谢杰伊·菲尔兹、布莱恩·戈茨和迪安·万普勒，在我寻找出版商时，他们给了我建议和帮助。凯里·肯普斯顿，感谢你对认证团队的支持。没有现实世界的经验，我就不会写这样一本书。致迈克·斯蒂芬斯，感谢你看了我的原“稿”，看到了潜力。我要感谢我的开发编辑托尼·阿里托拉(Toni Arritola)，是他告诉了我诀窍。非常感谢您的反馈，通过反馈，我学到了很多关于技术写作的知识。我的技术编辑 Michael Jensen，感谢您的反馈和快速回复。您的评论和建议有助于本书的成功。

最后，我要感谢所有在这项工作的开发阶段为我提供时间和反馈的 Manning 审查人员:Aaron Barton、Adriaan Beiertz、Bobby Lin、Daivid Morgan、Daniel、Domingo Salazar、Grzegorz Mika、Hå vard Wall、Igor van Oostveen、Jens Christian Bredahl Madsen、Kamesh Ganesan、Manu Sareena、Marc-安东尼·泰勒、马尔科·西蒙尼·祖彭、玛丽·安妮·泽格森、Nicolas Acton、Ninoslav Cerkez、Patrick Regan

## 关于这本书

我用 Python 来教授安全性，而不是相反。换句话说，当你读这本书的时候，你会学到比 Python 更多的安全知识。这有两个原因。第一，安全性很复杂，Python 不复杂。其次，编写大量的自定义安全代码并不是保护系统的最佳方式；繁重的工作应该总是委托给 Python、库或工具。

本书涵盖了初级和中级安全概念。这些概念是用初级 Python 代码实现的。安全性或 Python 的材料都不先进。

### 谁应该读这本书

本书中的所有例子都模拟了在现实世界中开发和保护系统的挑战。因此，将代码推向生产环境的程序员将学到最多的东西。初级 Python 技能，或者任何其他主要语言的中级经验是必需的。你当然不需要成为一个 web 开发者来学习这本书，但是对 web 的基本理解会让你更容易理解后半部分。

也许你不构建或维护系统；相反，你测试他们。如果是这样，你会对*和*要测试什么有更深刻的理解，但我甚至没有试图教*如何测试*。如你所知，这是两种不同的技能。

与一些安全书籍不同，这里的例子都没有假设攻击者的观点。因此，这个群体学到的东西最少。如果对他们有任何安慰的话，在某些章节中我让恶棍们赢了。

### 这本书是如何组织的:路线图

本书的第一章通过对安全标准、最佳实践和基础知识的简要介绍设定了期望。其余 17 章分为三个部分。

第 1 部分“加密基础”用一些加密概念奠定了基础。这种材料在第 2 部分和第 3 部分反复出现。

*   第 2 章直接探讨了带有哈希和数据完整性的加密技术。在这个过程中，我介绍了整本书中出现的一小群人物。

*   第三章摘自第二章。本章通过密钥生成和密钥哈希处理数据认证。

*   第 4 章涵盖了任何安全书籍的两个必修主题:对称加密和保密性。

*   和第三章一样，第五章是从它的前身中提取出来的。本章涵盖了非对称加密、数字签名和认可。

*   第 6 章将前几章的许多主要观点结合到一个无处不在的网络协议中，即传输层安全性。

第 2 部分“认证和授权”包含了本书中最有用的商业资料。这一部分的特点是大量与安全相关的常见用户工作流的实际操作说明。

*   第 7 章介绍了 HTTP 会话管理和 cookies，为后面章节中讨论的许多攻击奠定了基础。

*   第 8 章是关于身份的，介绍了用户注册和用户认证的工作流程。

*   第 9 章介绍了密码管理，是最有趣的一章。这份材料在很大程度上建立在前几章的基础上。

*   第 10 章使用另一个关于权限和组的工作流从认证过渡到授权。

*   第 11 章以 OAuth 结束了第 2 部分，OAuth 是一种行业标准授权协议，旨在共享受保护的资源。

读者发现第三部分“抵抗攻击”是这本书最具对抗性的部分。这种材料更容易消化，也更令人兴奋。

*   第 12 章深入到操作系统，主题包括文件系统、外部可执行文件和外壳。

*   第 13 章教你如何用各种输入验证策略抵御大量注入攻击。

*   第 14 章完全集中在最臭名昭著的注入攻击，跨站脚本。你可能已经预见到了。

*   第 15 章介绍内容安全政策。在某些方面，这可以被认为是跨站点脚本的一个附加章节。

*   第 16 章涵盖了跨站点请求伪造。本章结合了前几章的几个主题和 REST 最佳实践。

*   第 17 章解释了同源政策，以及为什么我们会时不时地使用跨源资源共享来放宽它。

*   本书的第 18 章以关于点击劫持的内容和一些保持你的技能与时俱进的资源结束。

### 关于代码

这本书包含了许多源代码示例，既有编号列表，也有普通文本。在这两种情况下，源代码都被格式化为一个 `fixed-width font like this` 以将其与普通文本分开。有时代码也是 **`in bold`** 以突出显示与本章中之前的步骤有所不同的代码，例如当一个新特性添加到现有的代码行时。

在很多情况下，原始源代码已经被重新格式化；我们添加了换行符并重新设计了缩进，以适应书中可用的页面空间。在极少数情况下，这还不够，清单中包含了行继续标记(-)。此外，当在文本中描述代码时，源代码中的注释经常被从清单中删除。代码注释伴随着许多清单，突出了重要的概念。

### liveBook 论坛

购买*全栈 Python Security* 包括免费访问曼宁出版社运营的私人网络论坛，在这里你可以对这本书发表评论，提出技术问题，并获得作者和其他用户的帮助。进入论坛，进入[https://live book . manning . com/book/practical-python-security/welcome/v-4/](https://livebook.manning.com/book/practical-python-security/welcome/v-4/)。你也可以在了解更多关于曼宁的论坛和行为准则。

曼宁对我们读者的承诺是提供一个场所，让读者个人之间以及读者和作者之间进行有意义的对话。作者对论坛的贡献仍然是自愿的(无报酬的)，这并不是对作者参与的任何具体数量的承诺。我们建议你试着问作者一些有挑战性的问题，以免他的兴趣偏离！只要这本书还在印刷中，就可以从出版商的网站上获得论坛和以前讨论的档案。

## 关于作者

Dennis Byrne 是 23andMe architecture 团队的成员，负责保护超过 1000 万客户的基因数据和隐私。在 23andMe 之前，丹尼斯是 LinkedIn 的软件工程师。丹尼斯是一名健美运动员，也是全球水下探险家(GUE)的洞穴潜水员。他目前住在硅谷，远离他长大和上学的地方阿拉斯加。

## 关于封面插图

在*全栈蟒蛇安全*封面上的数字标题为“Homme Touralinze”，即西伯利亚某个地区的秋明人。这幅插图摘自雅克·格拉塞特·德·圣索弗(1757-1810)的《各国服饰集锦》，书名为《T4 服饰》,于 1797 年在法国出版。每幅插图都是手工绘制和上色的。Grasset de Saint-Sauveur 丰富多样的藏品生动地提醒我们，仅仅在 200 年前，世界上的城镇和地区在文化上是多么的不同。人们彼此隔绝，说着不同的方言和语言。在街上或乡下，很容易通过他们的穿着来辨别他们住在哪里，他们的职业或社会地位。

从那以后，我们的穿着方式发生了变化，当时如此丰富的地区差异也逐渐消失了。现在很难区分不同大陆的居民，更不用说不同的城镇、地区或国家了。也许我们已经用文化多样性换取了更多样化的个人生活——当然是更多样化和快节奏的科技生活。

在一个很难区分计算机书籍的时代，曼宁用基于两个世纪前丰富多样的地区生活的书籍封面来庆祝计算机行业的创造性和主动性，格拉塞特·德圣索维尔的图片使这些书籍重现了生机。