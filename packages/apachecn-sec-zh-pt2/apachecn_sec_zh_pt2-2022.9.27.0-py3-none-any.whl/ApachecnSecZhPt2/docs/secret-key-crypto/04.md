# 四、密码学家的工具箱

本章 涵盖

*   用于密码的分级系统
*   替代密码
*   换位 密码
*   分割，将字母分割成更小的单元
*   伪随机数发生器

秘钥密码是由一些基本元素构成的。你可以认为这些是交易的工具。要构建一个强大的密码，你需要工具箱中的所有这些工具。这并不意味着你应该使用每个密码中的每个元素。这可能会导致额外的复杂性，而不会提高安全性。你的密码会更慢，没有额外的好处。本章包括替换、转置、分段和随机数。我在第 10 章介绍了其他工具，如文本压缩，在第 11 章介绍了块链接。

在讨论元素之前，先说实力。密码的强度是用比特来衡量的。每一位代表一个二进制选择。如果有一个密码，其中每个密文只能代表两个可能的明文之一，那么该密码的强度将为 1 位。举个例子，

0 =我们输了。

1 =我们赢了。

密钥的大小是决定密码强度的一个限制因素。如果密码使用 64 位密钥，那么它的强度不能超过 64 位，但是如果密码较弱，强度可以更小。

![4-unnumb-1](img/4-unnumb-1.png)

## 4.1 评级系统

按照 的顺序为了让你对本书中描述的密码的优势有一个大致的感觉，我将密码分为一到十个等级。这些是我的个人评级，基于我的经验和我对使用我所知的最佳技术破解密码需要多少努力的分析，以及这些密码相互之间以及与实践中被破解或未被破解的历史密码的比较。我在每个评级之前的部分给出了很多分析:

*   一种表示一个没有受过训练的初学者只用纸和笔，适度的努力就能破解的密码。

*   “二”表示一个有经验的业余爱好者或爱好者仅用纸和铅笔就能破解的密码。

*   三是一个熟练的业余密码学家可以用手破解的密码。

*   四个或五个意味着需要一台计算机，一个训练有素的密码专家，或者两者都需要。

*   从 6 到 9 表示对手专家需要多少计算能力。

*   10 代表一种可以对抗国家密码机构的密码，该机构拥有大量训练有素的密码专家，使用当今最大的超级计算机。

有时我会跳出这个范围。零表示不需要纸笔就能理解密码，如猪拉丁或**ignitrw****EHT****SDROW****SDRAWKCAB**。11 的评级意味着该密码将经得起未来潜在的超级计算机的考验，远远强于量子计算机或我们目前设想的超级计算机。

通过看我如何评价不同的密码，你可以得到如何评价你在别处看到的或你自己发明的密码的要点。每个评级只是一个估计，并不能保证实力。保证来自于执行第 12 章 中描述的分析。

## 4.2 替换

密码学家工具箱里的第一个工具就是换人。课文中一个单位代替另一个单位。明文单元可以是单个字母、成对字母或更长的块。密文单元可以是字母、字母组、数字组或字母-数字组合。当所有单位都是单字母时，密码称为*简单替换* 或*单字母* 。在计算机密码学中，单位可以是比特、字节或任意长度的比特或字节块。本节简要介绍了一下。在第五章和第六章有一个完整的讨论。

已知最古老的替代密码之一是*凯撒* *密码*，由尤利乌斯·凯撒使用并可能发明，其中字母表中的每个字母都由后面 3 个位置的字母替代。在现代使用中，这可能是任何固定数量的位置更早或更晚。凯撒 密码被评为一级。

没有要求所有的明文单元都具有相同的长度。假设密码采用字母表中的字母并替换成 2 位数对。字母表只有 26 个字母，但有 100 个可能的数字对。这意味着有 74 对额外的密码可以用于其他目的。一种已经使用了数百年的方法是为常见的字母对提供替代品，如 TH、er、on、as 和 NT，除了单个字母之外，可能还有像 and 和 and 这样的简短单词。明文单元的长度将是 1、2 或 3 个字母。这使得数字对的频率更加一致。因为字母频率的差异可以用来破解密码，所以让频率更均匀会让密码更强。

另一种方法是使用额外的字母对来替代一些常见的字母。这叫*谐音*换人 。例如，您可以为 E 提供 10 个替代项，为 T 提供 8 个替代项，依此类推。一个给定字母的多个替代称为*同音字* 。这类似于英语中同音字 F 和 PH 都代表同一个音。提供多种替代物使得 100 个数字对的频率更加均匀。自然，字母对和谐音替换这两种方法可以结合使用，以获得数字对更均匀的频率。换句话说，这些方法阻止对手使用频率分析。

### 4.2.1 霍夫曼码

在 的计算机语境中密文单位可以是比特串。一个很好的例子就是*霍夫曼编码* ，由大卫·a·霍夫曼于 1952 年在麻省理工学院上学时开发。我不会讨论优化代码集的方法，我只会给出一般概念作为一个可变长度二进制代码的例子。在霍夫曼编码中，最频繁的字母得到短码，而较少的字母得到长码，这是基于底层的字母频率表。因此，需要更少的比特来表达消息。这叫做*文本压缩* 。在 10.7 节中有更强的文本压缩方法。

英语中出现频率最高的字母是 E 和 T，各占 1/8 的时间。由于 8 = 2 <sup class="fm-superscript">3</sup> 我们用 3 位来表示 E 和 T，我们可以任意选择任意 3 位的值，比如 E = 100，T = 111。我把这种方法叫做*混合霍夫曼*。下一个最常见的是 A、O、I、N、S、R、h，每一个出现的时间大约是 1/16，所以我们用 4 位来表示每一个。我们可以使用任何 4 位代码，除了已经使用的以 100 或 111 开头的代码。下一组字母是 D、L、U、C、M、F、Y，每组出现的时间约为 1/32，所以需要 5 位代码。以此类推。

这是我根据 150，000 个英文字母的计数创建的一组混合霍夫曼代码。其他语言各不相同。霍夫曼码具有*前缀属性* ，即没有任何码是任何更长码的前缀。例如，如果 ABCD 是一个代码，那么 ABCDE 不可能也是任何二进制数字 A、B、C、D、e 的代码。

![4-unnumb-2](img/4-unnumb-2.png)

使用这些代码组，单词 STYLE 将被编码为**0110****111****11011****01000****100**。将此以 4 位为一组重写，得到**0110****1111****1011****0100****0100**，也就是十六进制的 **6FB44** 。

虽然桑德拉的敌人艾米丽几乎不可能识别密文中单个字母的代码组，但艾米丽可以搜索更长的重复比特串。这些将代表常见的字母对，称为*，字母三元组，称为*三元组* ，或单词。例如，任何给定的 10- 位串应该每 2 <sup class="fm-superscript">10</sup> 或 1024 次出现一次。如果一个 10 位的字符串在 1024 个字符串中出现 20 次或更多次，那么它几乎肯定代表单词 the，这是英语中最常见的单词。如果你已经确定了文本中的单词 the，那么你可以寻找像 THERE 或这些这样的扩展，因为重复的 e 很容易被发现。混合霍夫曼是 额定 三种。*

 *## 4.3 换位

第二个主要的密码工具是换位，改变消息中字符的顺序。最简单的方法就是*路线换位* 。信息的字母以一种顺序写入网格，并以不同的顺序读出。本节提供了一个快速浏览。完整的讨论在第七章。

例如，有 25 个字母的信息“贼中无爱”,从左到右横着写在这个 5×5 的网格中，并沿着列从上到下读出。当从上到下阅读时，该网格中最左边的列是**。**

 **![4-unnumb-3](img/4-unnumb-3.png)

将字母写入网格和从网格中读出字母的常见路线包括直着穿过行，向左或向右，直着向上或向下穿过列，交替穿过行的左和右，交替向上和向下穿过列，对角地从任何角落开始，对角地在交替的方向上，或者顺时针或逆时针螺旋，向内或向外。路线换位密码 被评为 之一。

## 4.4 分段

分割 是将字符分割成更小的单位。我们已经看到一种方法，用二进制数表示一个字符。该二进制数的每一位都可以作为一个独立的单元进行处理、替换或转置。本节介绍分段。第 9 章和第 10 章有详细的讨论。

将一个字母表示为两位数的经典方法是*波利比乌斯方格*，它是由希腊历史学家波利比乌斯在公元前二世纪发明的。这是一个 5×5 的正方形，使用混合字母表，带有关键字示例。请注意，字母 I 和 J 共享一个单元格，以使 26 个字母的字母表适合 25 个单元格的网格。

![4-unnumb-4](img/4-unnumb-4.png)

因为 A 在单元格 3 的第 2 行，所以用 23 表示。b 是 33，C 是 34，以此类推，直到用 21 表示的 Z。I 和 J 都用 44 表示。然后，这些数字可以用各种方式替换、调换和重新组合。使用这个格子，或者以不同的混合顺序排列的另一个波利比乌斯方块，可以将成对的数字变回字母。

现代版本会用 ASCII 码或 UTF 8 码中的十六进制表示来代替每个字符。因此 A = 41，B = 42，C = 43，一直到 Z = 5A。这些十六进制数字同样可以被替换、转置、重新分组并变回字节。

一个有趣的例子是 1910 年由 M. E .欧哈弗发明的*分段摩尔斯*。欧哈弗总是用 M. E .来称呼他，因为他不喜欢他的名字，那是莫尔。

历史笔记

克雷格·鲍尔的 *秘史:密码学的故事* 第 241 页的一个脚注指出，M. E .奥哈佛是多产低俗小说作家肯德尔·福斯特·克罗森的笔名之一。这不是真的。克罗森有时使用希伯来文*中的笔名 m . e . chaber*、 מחבר ，意为*作者*。

在分段莫尔斯电码中，字母被分成固定大小的组，比如 7 个，用/作为字母分隔符，替换成对应的莫尔斯电码。然后，代码组的长度被反转，并且调整大小的组被变回字母。

![4-unnumb-5](img/4-unnumb-5.png)

莫尔斯电码是阿尔弗雷德·维尔在 1840 年发明的，并以他的雇主塞缪尔·f·b·莫尔斯的名字命名。

这个密码有几个明显的弱点。由于它使用标准的莫尔斯字母表，唯一的关键是字母组的长度，只需几次尝试就可以猜到。明文字母经常被自己代替。有 30 个不同的莫尔斯电码组，但只有 26 个字母，所以需要 4 个额外的字符。欧哈弗使用了日耳曼语的、和。分段莫尔斯被评为一级。

这些问题可以通过两个改变得到部分解决:(1)只使用长度为 1、3 和 4 的莫尔斯群。有 26 个这样的组，完全符合 26 个字母的字母表。(2)打乱字母表的顺序，或者，等价地，打乱莫尔斯码组的顺序。我称这个增强版的*FR-actioned Morse*。例如，使用关键字 MIXEDALPHBT 将字母表与莫尔斯组按标准顺序混合，您会得到

![4-unnumb-6](img/4-unnumb-6.png)

即使有这些改进，FR-actioned Morse 被评为只有 两种。

## 4.5 随机数发生器

一个 随机数发生器可以是在某个给定范围内产生一个数字序列的任何东西。这些数字可以是一位、8 位字节、十进制数字或任何其他所需范围内的数字。例如，在 0 到 25 范围内的数字，对应于字母表中的 26 个字母，对于一些加密目的是有用的。本节介绍这个主题。完整的讨论在第 13 章。

认识到没有“随机数”这种东西是很重要的你不能说 51 是一个随机数，而 52 不是，反之亦然。然而，你可以说序列 51，52，53，54，...不是随机的。这个顺序是完全可以预测的。随机性是序列或发生器的一种属性，而不是序列中单个数字的属性。说“一个随机序列的数字”比“一个序列的随机数”更准确

发生器可能是一个物理过程，比如宇宙射线、盖革计数器的乒乒乓乓、计算机按键的精确计时、在强风中飘扬的旗帜、海浪撞击产生的水花或赶火车的人群。大多数物理源的速度对于加密来说不够快，但是数字序列可以存储在计算机文件中以备后用。

生成器也可以是一个数学函数或计算机程序，每次被调用时都会产生一个数字。数学算法产生的随机数称为*伪随机*数 以区别于*真随机*数 。它们被认为比真正的随机数弱，因为确定随机序列的一部分的对手可能能够计算出前面和后面的数字，从而读取消息。数学函数永远不会产生真正的随机数。在第 13.8 节中，我展示了用于生成密码安全伪随机数序列的方法，该伪随机数序列被设计来防止对手扩展该序列的一个片段。

伪随机序列和真随机序列的一个关键区别是，伪随机序列最终会重复，而真随机序列从不重复。序列重复之前的项数称为其*周期*。顺序 3，1，9，2，4 ，3，1，9，2，4，3，1，9，2，4，3，...例如，具有带下划线的句点 5。一般来说，周期越长，密码越强。

仅仅因为一个数字序列是随机的，并不意味着这些数字是同样可能的。例如，假设你正在观察穿过一座繁忙的桥的汽车的颜色。颜色是随机的，但某些颜色比其他颜色更常见。白色、黑色、银色和红色远比橙色、紫红色或黄绿色更常见。类似地，在掷骰子的游戏中，如果骰子是公平的，那么每次投掷都是随机的，然而投掷 7 的可能性是投掷 12 的六倍。

在第 13.14.1 和 13.14.2 节中，我讨论了如何“收获”这类序列中的随机性，以获得数字具有基本相等概率的序列。我将假设任何随机数发生器都以相等的概率产生数字。这叫做*均匀分布* ，或者*等概率分布* 。有了一个好的随机数生成器，生成的数字的对和三等也将具有统一的概率，也许会达到八倍甚至更高。

### 4.5.1 链式数字发生器

让 me 用一个伪随机数发生器的例子来结束这一节，这个例子可以用纸笔很容易地完成。不需要电脑。姑且称之为*链式数字发生器*。从写任何 7 位十进制数开始。这 7 位数称为*种子* ，或*初始值* ，或*初始化向量* 。它们可以被认为是任何包含该生成器的密码的密钥或密钥的一部分。要获得第一个伪随机数字，只需将第一个和最后一个数字相加。将这个新数字添加到序列中，并涂黑第一个数字。所以，从 3920516 开始，我们加 3+6 得到 9。

![4-unnumb-7](img/4-unnumb-7.png)

任何时候总和超过 9，我们就掉十位数。也就是说，加法是以 10 为模进行的。这有时又称为*非进位加法* 。为了得到第二个伪随机数字，我们重复这个过程。这里 9+9 等于 18。我们把十位数降低到 8 。

![4-unnumb-8](img/4-unnumb-8.png)

这个过程可以重复进行，以获得所需数量的伪随机十进制数字。

![4-unnumb-9](img/4-unnumb-9.png)

产生的伪随机序列为 **9800562199940232...** 。

注意，如果种子中的所有数字都是偶数，那么所有生成的数字也将是偶数。同样，如果所有数字都可以被 5 整除，即 0 或 5，那么所有生成的数字都可以被 5 整除。在这种情况下，周期可能不超过 128，因为种子中有 7 个数字，并且只有 2 个 <sup xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:epub="http://www.idpf.org/2007/ops" class="fm-superscript">7 个</sup> = 128 个可能的 0 和 5 的组合。因为这种种子不能长时间繁殖，所以被称为不合格的*。对于链式数字生成器，合格的种子必须包含至少一个奇数和一个不是 5 的倍数的数字。比如 2222225 是合格的种子，但是 2222222 和 5555555 是不合格的。对于合格的 7 位数种子，周期将始终为 2，480，437。*

 *该发生器具有自制伪随机数发生器的典型行为。有 10 个 <sup class="fm-superscript">7 个</sup>可能的 7 位数种子。如果您从任何种子开始，生成器将循环通过一些数字序列，直到它再次产生该种子，因此 7 位数的集合被分成几个离散的循环，每个循环都有自己的周期。如果你选择了一个合格的种子，那么循环将总是有 2，480，437 个数字的最大可能周期。这个长度有 4 个独立的周期，加上不合格种子产生的几个更短的周期。

对于其他大小的种子来说，行为是相似的。即使当最大循环非常短时，也经常有很高的概率获得最大循环，因为可能有许多最大循环。下表显示了使用合格种子获得给定长度周期的概率:

<colgroup class="calibre15"><col class="calibre16" span="1" width="33.33%"> <col class="calibre16" span="1" width="33.33%"> <col class="calibre16" span="1" width="33.33%"></colgroup> 
| 

**位数**

 | 

**时期**

 | 

**概率**

 |
| 4 | 1560 英镑 | 100% |
| 5 | 168 | 86.7% |
| 6 | 196812 | 99.974% |
| 7 | 2480437 | 100% |
| 8 | 15624 人 | 98.817% |
| 9 | 28515260 | 79.999% |
| 至少 2851526 | 99.9988% |
| 10 | 1736327236 | 86.9% |
| 至少 248，046，748 | 99.31% |
| 至少 13，671，868 | 100% |

从表中可以看出，5 位数和 8 位数的种子长度是不安全的。它们产生很大比例的非常短的周期。7 位数和 10 位数的种子长度是最好的，因为你总是保证有一个很长的周期 。

这个随机数发生器严格来说是一个演示模型，只是为了展示使用简单的手工方法可以实现什么。它不适合 高安全性 的工作。

## 4.6 有用的组合，浪费的组合

本章中的 4 种基本技巧可以用在无数种组合中，我将在本书的剩余部分探讨这些组合。然而，重要的是从一开始就认识到，并不是每种组合都是有益的。有些组合增加了功，但没有增加力量。

考虑一些初学者尝试的想法。他们对消息执行简单的替换，然后对产生的文本执行第二次简单的替换，然后第三次，等等，进行 5、10 甚至 100 轮。这是白费力气。执行两个简单的替换和执行一个是一样的，但是使用不同的混合字母表，所以执行许多简单的替换不会增加任何力量。这里有一个例子。这两个替换混合了第一个和第二个键。第三次替换相当于先执行第一次替换，然后执行第二次替换。

![4-unnumb-10](img/4-unnumb-10.png)

让我们试一个例子。如果我们对单词 **进行加密，例如** 使用第一次替换，结果是 **IUXEJDI** 。如果 **IUXEJDI** 用第二次替换加密，结果是 **CLQYOXC** 。你可以自己验证一下，加密 **例** 等价替换产生 **CLQYOXC** 。

进行一次加密，然后进行第二次加密称为*，构成* 两次加密。前面的例子表明，组合两个简单的替换只会产生另一个简单的替换。如果第一次加密使用的是一个代码，那么在这个代码之后加上一个密码就叫做*超级解密* 。超级解密最常见的形式是非进位加法，或模 10 加法，其工作原理如下:

![4-unnumb-11](img/4-unnumb-11.png)

### 4 . 6 . 1 baz eries 4 型密码

让我们 来看看相反的情况。让我们来看一个密码，使用一个替换步骤，然后是一个非常简单的转置产生一个更强的密码。

这个密码是由才华横溢、脾气暴躁且爱责骂人的法国密码学家étienne baz eries 于 1898 年提出的。我不知道 Bazeries 给这个密码起了什么名字。我称之为 *Bazeries Type 4* 因为这是他在 19 世纪 90 年代向外交使团提出的 4 个密码中的最后一个。这很容易用手工完成。

baz eries type 4 由一个简单的替换和一个简单的换位组成，我称之为*分段反转* 。转置根据小整数序列的键来反转文本的小段。这里有一个例子，使用关键字 BAZERIS 来混合替换字母表，使用键 4，2，3 来进行变调。

![4-unnumb-12](img/4-unnumb-12.png)

这种类型的换位可以用来加强许多不同类型的密码，所以它应该有自己的名字。姑且称之为*分段反转*。您可以通过以正常顺序混合几段文本来加强这种换位，也许可以在数字键中使用负数。下面是一个使用数字键 3，4，-3，2 的例子。注意这个键相当于 3，4，1，1，1，2。

![4-unnumb-13](img/4-unnumb-13.png)

齐弗勒局的密码专家无法破解巴兹瑞提供的任何样本信息。尽管付出了相当大的努力，这些消息仍然没有解决 40 年，直到著名的建筑师和业余密码学家罗萨里奥·坎德拉 解决了它们，并写了一本关于他是如何做到的书(*巴兹里司令官的军事密码*，卡尔达诺斯出版社:纽约，1938 年 )。

然而，坎德拉无法直接解密这些信息。相反，他发现并利用了 Bazeries 从一把钥匙生成替代字母表的方式中的一个弱点。如果 Bazeries 使用了一种更强的混合密码字母的方法，坎德拉就不可能破译这些信息。因此，混合字母表的 Bazeries 类型 4 被评定为 5。很好地结合了两种方法，每种方法都被评为一。

历史花絮

坎德拉是哥伦比亚建筑学院的毕业生，所以他计划在哥伦比亚大学出版社出版他的书。时任美国密码学家学院院长的威廉·f·弗里德曼(William F. Friedman)得到了这方面的风声，并机密封锁了该出版物。这再次证明了 bazaresType 4 密码的实力。****