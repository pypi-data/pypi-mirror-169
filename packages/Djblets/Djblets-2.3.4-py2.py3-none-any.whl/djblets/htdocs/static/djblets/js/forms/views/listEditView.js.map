{"version":3,"file":"listEditView.js","names":["entryTemplate","_","template","Djblets","Forms","ListEditView","Backbone","View","extend","events","initialize","options","_inputAttrs","inputAttrs","_removeText","removeText","_sep","sep","_values","render","$el","data","_$list","children","find","each","idx","el","push","$","val","_$addBtn","_$hidden","_addItem","e","preventDefault","stopPropagation","$entry","index","length","insertBefore","on","end","_onBlur","_removeItem","$target","target","closest","attr","remove","splice","siblings","filter","v","join"],"sources":["listEditView.es6.js"],"sourcesContent":["(function() {\n\n\nconst entryTemplate = _.template(dedent`\n    <li class=\"djblets-c-list-edit-widget__entry\"\n        data-list-index=\"<%- index %>\">\n     <input type=\"text\"<%= inputAttrs %>>\n     <a href=\"#\" class=\"djblets-c-list-edit-widget__remove-item\"\n        role=\"button\" title=\"<%- removeText %>\">\n       <span class=\"fa fa-times\"></span>\n     </a>\n    </li>\n`);\n\n/**\n * A view for editing a list of elements.\n *\n * This is the JavaScript view for\n * :py:class:`djblets.forms.widgets.ListEditWidget`.\n */\nDjblets.Forms.ListEditView = Backbone.View.extend({\n    events: {\n        'click .djblets-c-list-edit-widget__add-item': '_addItem',\n        'click .djblets-c-list-edit-widget__remove-item': '_removeItem',\n        'blur .djblets-c-list-edit-widget__input': '_onBlur',\n    },\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         The view options.\n     *\n     * Option Args:\n     *     inputAttrs (string):\n     *         The attributes that should be added to each ``<input>`` element.\n     *\n     *     removeText (string):\n     *         The localized text for removing an item.\n     *\n     *     sep (string):\n     *         The list separator. It will be used to join the list of values\n     *         into a string.\n     */\n    initialize(options) {\n        this._inputAttrs = options.inputAttrs;\n        this._removeText = options.removeText;\n        this._sep = options.sep;\n        this._values = [];\n    },\n\n    /**\n     * Render the view.\n     *\n     * Since most of the view is rendered by Django, this just sets up some\n     * event listeners.\n     *\n     * Returns:\n     *     Djblets.Forms.ListEditView:\n     *     This view.\n     */\n    render() {\n        this.$el.data('djblets-list-edit-view', this);\n\n        this._$list = this.$el.children(\n            '.djblets-c-list-edit-widget__entries');\n        this._$list.find('.djblets-c-list-edit-widget__input')\n            .each((idx, el) => this._values.push($(el).val()));\n        this._$addBtn = this.$el.children(\n            '.djblets-c-list-edit-widget__add-item');\n        this._$hidden = this.$el.children(\n            '.djblets-c-list-edit-widget__value');\n\n        return this;\n    },\n\n    /**\n     * Add an item to the list.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event that triggered this event handler.\n     */\n    _addItem(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $entry = $(entryTemplate({\n                index: this._values.length,\n                inputAttrs: this._inputAttrs,\n                removeText: this._removeText,\n            }))\n            .insertBefore(this._$addBtn);\n\n        $entry\n            .find('.djblets-c-list-edit-widget__add-item')\n                .on('click', e => this._addItem(e))\n            .end()\n            .find('.djblets-c-list-edit-widget__input')\n                .on('change', e => this._onBlur(e))\n            .end();\n\n        this._values.push('');\n    },\n\n    /**\n     * Remove an item.\n     *\n     * When there is only a single item in the list, we clear it instead of\n     * removing it so there is always at least one ``<input>`` element and\n     * value in the list.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event that triggered this event handler.\n     */\n    _removeItem(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $target = $(e.target);\n        const $entry = $target.closest('.djblets-c-list-edit-widget__entry');\n        const index = $entry.attr('data-list-index');\n\n        if (this._values.length > 1) {\n            $entry.remove();\n            this._values.splice(index, 1);\n            this._$list.find('.djblets-c-list-edit-widget__entry')\n                .each((idx, el) => $(el).attr('data-list-index', idx));\n        } else {\n            this._values[index] = '';\n            $target.siblings('.djblets-c-list-edit-widget__input').val('');\n        }\n\n        this._$hidden\n            .val(this._values.filter(v => v.length > 0).join(this._sep));\n    },\n\n    /**\n     * Update the internal values when a field changes.\n     *\n     * Args:\n     *     e (Event):\n     *         The blur event.\n     */\n    _onBlur(e) {\n        const $target = $(e.target);\n        const index = $target\n            .closest('.djblets-c-list-edit-widget__entry')\n            .attr('data-list-index');\n\n        this._values[index] = $target.val();\n        this._$hidden\n            .val(this._values.filter(v => v.length > 0).join(this._sep));\n    },\n});\n\n\n})();\n"],"mappings":"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"}