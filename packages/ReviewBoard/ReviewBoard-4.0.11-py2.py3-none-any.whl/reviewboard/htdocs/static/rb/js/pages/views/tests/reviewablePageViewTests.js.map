{"version":3,"file":"reviewablePageViewTests.js","names":["suite","pageTemplate","$editReview","$shipIt","page","pageView","beforeEach","$container","$","html","appendTo","$testsScratch","RB","DnDUploader","instance","find","ReviewablePage","checkForUpdates","reviewRequestData","id","loaded","state","ReviewRequest","PENDING","editorData","mutableByUser","statusMutableByUser","parse","ReviewablePageView","el","model","reviewRequest","get","spyOn","and","callFake","options","context","ready","call","render","afterEach","remove","describe","it","expect","not","toBe","undefined","pendingReview","commentIssueManager","reviewRequestEditor","reviewRequestEditorView","ReviewDialogView","click","create","toHaveBeenCalled","calls","argsFor","review","window","returnValue","success","callThrough","draftReviewBanner","confirm","publish","save","hideAndReload","summary","user","url","fullname","username","$bubble","bubbleView","trigger","_updatesBubble","length","$el","is","text","attr","close","toHaveBeenCalledWith","info","NotificationManager","_canNotify","_onReviewRequestUpdated","notify","_showUpdatesBubble"],"sources":["reviewablePageViewTests.es6.js"],"sourcesContent":["suite('rb/pages/views/ReviewablePageView', function() {\n    const pageTemplate = dedent`\n        <div id=\"review-banner\"></div>\n        <a href=\"#\" id=\"review-action\">Edit Review</a>\n        <a href=\"#\" id=\"ship-it-action\">Ship It</a>\n    `;\n\n    let $editReview;\n    let $shipIt;\n    let page;\n    let pageView;\n\n    beforeEach(function() {\n        const $container = $('<div/>')\n            .html(pageTemplate)\n            .appendTo($testsScratch);\n\n        RB.DnDUploader.instance = null;\n\n        $editReview = $container.find('#review-action');\n        $shipIt = $container.find('#ship-it-action');\n\n        page = new RB.ReviewablePage({\n            checkForUpdates: false,\n            reviewRequestData: {\n                id: 123,\n                loaded: true,\n                state: RB.ReviewRequest.PENDING,\n            },\n            editorData: {\n                mutableByUser: true,\n                statusMutableByUser: true,\n            },\n        }, {\n            parse: true,\n        });\n\n        pageView = new RB.ReviewablePageView({\n            el: $container,\n            model: page,\n        });\n\n        const reviewRequest = page.get('reviewRequest');\n\n        spyOn(reviewRequest, 'ready').and.callFake(\n            (options, context) => options.ready.call(context));\n\n        pageView.render();\n    });\n\n    afterEach(function() {\n        RB.DnDUploader.instance = null;\n\n        pageView.remove();\n    });\n\n    describe('Public objects', function() {\n        it('reviewRequest', function() {\n            expect(page.get('reviewRequest')).not.toBe(undefined);\n        });\n\n        it('pendingReview', function() {\n            const pendingReview = page.get('pendingReview');\n\n            expect(pendingReview).not.toBe(undefined);\n            expect(pendingReview.get('parentObject'))\n                .toBe(page.get('reviewRequest'));\n        });\n\n        it('commentIssueManager', function() {\n            expect(page.commentIssueManager).not.toBe(undefined);\n            expect(page.commentIssueManager.get('reviewRequest'))\n                .toBe(page.get('reviewRequest'));\n        });\n\n        it('reviewRequestEditor', function() {\n            const reviewRequestEditor = page.reviewRequestEditor;\n\n            expect(reviewRequestEditor).not.toBe(undefined);\n            expect(reviewRequestEditor.get('reviewRequest'))\n                .toBe(page.get('reviewRequest'));\n            expect(reviewRequestEditor.get('commentIssueManager'))\n                .toBe(page.commentIssueManager);\n            expect(reviewRequestEditor.get('editable')).toBe(true);\n        });\n\n        it('reviewRequestEditorView', function() {\n            expect(pageView.reviewRequestEditorView).not.toBe(undefined);\n            expect(pageView.reviewRequestEditorView.model)\n                .toBe(page.reviewRequestEditor);\n        });\n    });\n\n    describe('Actions', function() {\n        it('Edit Review', function() {\n            spyOn(RB.ReviewDialogView, 'create');\n\n            $editReview.click();\n\n            expect(RB.ReviewDialogView.create).toHaveBeenCalled();\n\n            const options = RB.ReviewDialogView.create.calls.argsFor(0)[0];\n            expect(options.review).toBe(page.get('pendingReview'));\n            expect(options.reviewRequestEditor).toBe(page.reviewRequestEditor);\n        });\n\n        describe('Ship It', function() {\n            let pendingReview;\n\n            beforeEach(function() {\n                pendingReview = page.get('pendingReview');\n            });\n\n            it('Confirmed', function() {\n                spyOn(window, 'confirm').and.returnValue(true);\n                spyOn(pendingReview, 'ready').and.callFake(\n                    (options, context) => options.ready.call(context));\n                spyOn(pendingReview, 'save').and.callFake(\n                    (options, context) => options.success.call(context));\n                spyOn(pendingReview, 'publish').and.callThrough();\n                spyOn(pageView.draftReviewBanner, 'hideAndReload');\n\n                $shipIt.click();\n\n                expect(window.confirm).toHaveBeenCalled();\n                expect(pendingReview.ready).toHaveBeenCalled();\n                expect(pendingReview.publish).toHaveBeenCalled();\n                expect(pendingReview.save).toHaveBeenCalled();\n                expect(pageView.draftReviewBanner.hideAndReload)\n                    .toHaveBeenCalled();\n                expect(pendingReview.get('shipIt')).toBe(true);\n                expect(pendingReview.get('bodyTop')).toBe('Ship It!');\n            });\n\n            it('Canceled', function() {\n                spyOn(window, 'confirm').and.returnValue(false);\n                spyOn(pendingReview, 'ready');\n\n                $shipIt.click();\n\n                expect(window.confirm).toHaveBeenCalled();\n                expect(pendingReview.ready).not.toHaveBeenCalled();\n            });\n        });\n    });\n\n    describe('Update bubble', function() {\n        const summary = 'My summary';\n        const user = {\n            url: '/users/foo/',\n            fullname: 'Mr. User',\n            username: 'user',\n        };\n        let $bubble;\n        let bubbleView;\n\n        beforeEach(function() {\n            page.get('reviewRequest').trigger('updated', {\n                summary: summary,\n                user: user,\n            });\n\n            $bubble = $('#updates-bubble');\n            bubbleView = pageView._updatesBubble;\n        });\n\n        it('Displays', function() {\n            expect($bubble.length).toBe(1);\n            expect(bubbleView.$el[0]).toBe($bubble[0]);\n            expect($bubble.is(':visible')).toBe(true);\n            expect($bubble.find('#updates-bubble-summary').text())\n                .toBe(summary);\n            expect($bubble.find('#updates-bubble-user').text())\n                .toBe(user.fullname);\n            expect($bubble.find('#updates-bubble-user').attr('href'))\n                .toBe(user.url);\n        });\n\n        describe('Actions', function() {\n            it('Ignore', function() {\n                spyOn(bubbleView, 'close').and.callThrough();\n                spyOn(bubbleView, 'trigger').and.callThrough();\n                spyOn(bubbleView, 'remove').and.callThrough();\n\n                $bubble.find('.ignore').click();\n\n                expect(bubbleView.close).toHaveBeenCalled();\n                expect(bubbleView.remove).toHaveBeenCalled();\n                expect(bubbleView.trigger).toHaveBeenCalledWith('closed');\n            });\n\n            it('Update Page displays Updates Bubble', function() {\n                spyOn(bubbleView, 'trigger');\n\n                $bubble.find('.update-page').click();\n\n                expect(bubbleView.trigger).toHaveBeenCalledWith('updatePage');\n            });\n\n            it('Update Page calls notify if shouldNotify', function() {\n                const info = {\n                    user: {\n                        fullname: 'Hello',\n                    },\n                };\n\n                RB.NotificationManager.instance._canNotify = true;\n                spyOn(RB.NotificationManager.instance, 'notify');\n                spyOn(RB.NotificationManager.instance,\n                      '_haveNotificationPermissions').and.returnValue(true);\n                spyOn(pageView, '_showUpdatesBubble');\n\n                pageView._onReviewRequestUpdated(info);\n\n                expect(RB.NotificationManager.instance.notify)\n                    .toHaveBeenCalled();\n                expect(pageView._showUpdatesBubble).toHaveBeenCalled();\n            });\n        });\n    });\n});\n"],"mappings":"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"}