{"version":3,"file":"draftReviewModelTests.js","names":["suite","model","parentObject","beforeEach","RB","BaseResource","links","reviews","href","DraftReview","rspNamespace","describe","callbacks","ready","success","error","spyOn","Backbone","Model","prototype","and","callFake","options","_","isFunction","context","call","expect","isNew","toBe","get","it","toHaveBeenCalled","_retrieveDraft","set","id","not","publish","trigger","toHaveBeenCalledWith"],"sources":["draftReviewModelTests.es6.js"],"sourcesContent":["suite('rb/resources/models/DraftReview', function() {\n    let model;\n    let parentObject;\n\n    beforeEach(function() {\n        parentObject = new RB.BaseResource({\n            links: {\n                reviews: {\n                    href: '/api/foos/'\n                },\n            },\n        });\n\n        model = new RB.DraftReview({\n            parentObject: parentObject,\n        });\n        model.rspNamespace = 'foo';\n    });\n\n    describe('Methods', function() {\n        let callbacks;\n\n        beforeEach(function() {\n            callbacks = {\n                ready: function() {},\n                success: function() {},\n                error: function() {},\n            };\n\n            spyOn(callbacks, 'ready');\n            spyOn(callbacks, 'success');\n            spyOn(callbacks, 'error');\n        });\n\n        describe('ready', function() {\n            beforeEach(function() {\n                spyOn(Backbone.Model.prototype, 'fetch')\n                    .and.callFake(options => {\n                        if (options && _.isFunction(options.success)) {\n                            options.success();\n                        }\n                    });\n                spyOn(parentObject, 'ready')\n                    .and.callFake((options, context) => {\n                        if (options && _.isFunction(options.ready)) {\n                            options.ready.call(context);\n                        }\n                    });\n                spyOn(model, '_retrieveDraft')\n                    .and.callFake((options, context) => {\n                        if (options && _.isFunction(options.ready)) {\n                            options.ready.call(context);\n                        }\n                    });\n            });\n\n            describe('With isNew=true', function() {\n                beforeEach(function() {\n                    expect(model.isNew()).toBe(true);\n                    expect(model.get('loaded')).toBe(false);\n                });\n\n                it('With callbacks', function() {\n                    model.ready(callbacks);\n\n                    expect(parentObject.ready).toHaveBeenCalled();\n                    expect(model._retrieveDraft).toHaveBeenCalled();\n                    expect(callbacks.ready).toHaveBeenCalled();\n                });\n            });\n\n            describe('With isNew=false', function() {\n                beforeEach(function() {\n                    model.set({\n                        id: 123,\n                    });\n                });\n\n                it('With callbacks', function() {\n                    model.ready(callbacks);\n\n                    expect(parentObject.ready).toHaveBeenCalled();\n                    expect(model._retrieveDraft).not.toHaveBeenCalled();\n                    expect(callbacks.ready).toHaveBeenCalled();\n                });\n            });\n        });\n\n        describe('publish', function() {\n            beforeEach(function() {\n                spyOn(model, 'save').and.callFake((options, context) => {\n                    options.success.call(context);\n                });\n            });\n\n            it('Triggers \"publishing\" event before publish', function() {\n                spyOn(model, 'trigger');\n                spyOn(model, 'ready');\n\n                model.publish();\n\n                expect(model.trigger).toHaveBeenCalledWith('publishing');\n            });\n\n            it('Triggers \"published\" event after publish', function() {\n                spyOn(model, 'trigger');\n\n                spyOn(model, 'ready').and.callFake((options, context) => {\n                    options.ready.call(context);\n                });\n\n                model.publish(callbacks);\n\n                expect(callbacks.success).toHaveBeenCalled();\n                expect(model.trigger).toHaveBeenCalledWith('published');\n            });\n\n            it('Sets \"public\" to true', function() {\n                spyOn(model, 'ready').and.callFake((options, context) => {\n                    options.ready.call(context);\n                });\n\n                expect(model.get('public')).toBe(false);\n\n                model.publish(callbacks);\n\n                expect(callbacks.success).toHaveBeenCalled();\n                expect(model.get('public')).toBe(true);\n            });\n        });\n    });\n});\n"],"mappings":"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"}