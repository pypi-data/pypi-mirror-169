{"version":3,"file":"reviewGroupModelTests.js","names":["suite","describe","url","callbacks","group","session","beforeEach","RB","UserSession","instance","create","username","watchedReviewGroupsURL","ReviewGroup","id","success","error","spyOn","watchedGroups","and","callThrough","it","$","callFake","request","expect","type","toBe","stat","setStarred","addImmediately","toHaveBeenCalled","apiCall","ajax","not","removeImmediately","name","data","addUser","set","isNew","removeUser"],"sources":["reviewGroupModelTests.es6.js"],"sourcesContent":["suite('rb/resources/models/ReviewGroup', function() {\n    describe('setStarred', function() {\n        const url = '/api/users/testuser/watched/groups/';\n        let callbacks;\n        let group;\n        let session;\n\n        beforeEach(function() {\n            RB.UserSession.instance = null;\n            session = RB.UserSession.create({\n                username: 'testuser',\n                watchedReviewGroupsURL: url,\n            });\n\n            group = new RB.ReviewGroup({\n                id: 1,\n            });\n\n            callbacks = {\n                success: function() {},\n                error: function() {},\n            };\n\n            spyOn(session.watchedGroups, 'addImmediately').and.callThrough();\n            spyOn(session.watchedGroups, 'removeImmediately').and.callThrough();\n            spyOn(RB, 'apiCall').and.callThrough();\n            spyOn(callbacks, 'success');\n            spyOn(callbacks, 'error');\n        });\n\n        it('true', function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.url).toBe(url);\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            group.setStarred(true, callbacks);\n\n            expect(session.watchedGroups.addImmediately).toHaveBeenCalled();\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n            expect(callbacks.success).toHaveBeenCalled();\n            expect(callbacks.error).not.toHaveBeenCalled();\n        });\n\n        it('false', function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('DELETE');\n                expect(request.url).toBe(url + '1/');\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            group.setStarred(false, callbacks);\n\n            expect(session.watchedGroups.removeImmediately).toHaveBeenCalled();\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n            expect(callbacks.success).toHaveBeenCalled();\n            expect(callbacks.error).not.toHaveBeenCalled();\n        });\n    });\n\n    describe('addUser', function() {\n        let callbacks;\n        let group;\n\n        beforeEach(function() {\n            group = new RB.ReviewGroup({\n                id: 1,\n                name: 'test-group',\n            });\n\n            callbacks = {\n                success: function() {},\n                error: function() {},\n            };\n\n            spyOn(RB, 'apiCall').and.callThrough();\n            spyOn(callbacks, 'success');\n            spyOn(callbacks, 'error');\n        });\n\n        it('Loaded group', function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.data.username).toBe('my-user');\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            group.addUser('my-user', callbacks);\n\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n            expect(callbacks.success).toHaveBeenCalled();\n        });\n\n        it('Unloaded group', function() {\n            spyOn($, 'ajax');\n\n            group.set('id', null);\n            expect(group.isNew()).toBe(true);\n\n            group.addUser('my-user', callbacks);\n\n            expect(RB.apiCall).not.toHaveBeenCalled();\n            expect($.ajax).not.toHaveBeenCalled();\n            expect(callbacks.error).toHaveBeenCalled();\n        });\n    });\n\n    describe('removeUser', function() {\n        let callbacks;\n        let group;\n\n        beforeEach(function() {\n            group = new RB.ReviewGroup({\n                id: 1,\n                name: 'test-group',\n            });\n\n            callbacks = {\n                success: function() {},\n                error: function() {},\n            };\n\n            spyOn(RB, 'apiCall').and.callThrough();\n            spyOn(callbacks, 'success');\n            spyOn(callbacks, 'error');\n        });\n\n        it('Loaded group', function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('DELETE');\n\n                request.success();\n            });\n\n            group.removeUser('my-user', callbacks);\n\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n            expect(callbacks.success).toHaveBeenCalled();\n        });\n\n        it('Unloaded group', function() {\n            spyOn($, 'ajax');\n\n            group.set('id', null);\n            expect(group.isNew()).toBe(true);\n\n            group.removeUser('my-user', callbacks);\n\n            expect(RB.apiCall).not.toHaveBeenCalled();\n            expect($.ajax).not.toHaveBeenCalled();\n            expect(callbacks.error).toHaveBeenCalled();\n        });\n    });\n});\n"],"mappings":"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"}